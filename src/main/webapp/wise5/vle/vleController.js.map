{"version":3,"sources":["vleController.es6"],"names":["VLEController","$scope","$rootScope","$filter","$mdDialog","$mdMenu","$state","AnnotationService","ConfigService","NotebookService","NotificationService","ProjectService","SessionService","StudentDataService","UtilService","$translate","workgroupId","getWorkgroupId","currentNode","pauseDialog","noteDialog","navFilters","getFilters","navFilter","name","projectStyle","getStyle","projectName","getProjectTitle","totalScore","getTotalScore","maxScore","notebookEnabled","isNotebookEnabled","notebookConfig","getNotebookConfig","reportItem","itemTypes","report","notes","constraintsDisabled","userType","getConfigParam","contextPath","homePath","script","getProjectScript","retrieveScript","then","Function","call","$on","event","args","previousNode","getCurrentNode","currentNodeId","id","updateStackHistory","updateVisitedNodesHistory","go","nodeId","componentId","componentType","category","eventName","eventData","eventNodeId","isGroupNode","saveVLEEvent","notifications","$watch","length","newValue","oldValue","newNotifications","getNewNotifications","notification","pauseScreen","unPauseScreen","snippableItems","imageObject","push","imageObjects","$","document","body","on","e","preventDefault","themePath","getThemePath","notebookItemPath","stateParams","stateParamNodeId","params","getLatestNodeEnteredEventNodeIdWithExistingNode","getStartNodeId","setCurrentNodeByNodeId","runStatus","getRunStatus","pause","periodId","getPeriodId","periods","tempPeriod","paused","$event","templateUrl","getCurrentNodeId","currentComponents","getComponentsByNodeId","currentComponent","$broadcast","show","parent","angular","element","targetEvent","clickOutsideToClose","locals","controller","NotebookContentSnippetController","controllerAs","bindToController","snippableItem","url","URL","createObjectURL","close","hide","chooseSnippet","addNewItem","$inject","endCurrentNodeAndSetCurrentNodeByNodeId","rootNode","mouseEventOccurred","getNewAmbientNotifications","newNotificationAggregates","timeDismissed","notificationNodeId","notificationType","type","newNotificationForNodeIdAndTypeExists","newNotificationAggregate","timeGenerated","latestNotificationTimestamp","notebookItemId","message","data","fromJson","annotationId","annotation","getAnnotationById","sort","n1","n2","filter","isAmbient","dismissCode","dismissNotification","ambientNotifications","currentNotification","notificationAggregate","goToNodeId","ev","template","escapeToClose","undefined","isPreview","hasActiveConstraints","activeConstraints","updateNodeStatuses","registerAdditionalProcessingFunction","additionalProcessingFunction","addAdditionalProcessingFunction","createAutoScoreAnnotation","runId","getRunId","toWorkgroupId","createAutoCommentAnnotation","getLatestAnnotationForComponent","annotationType","getLatestAnnotation","updateAnnotation","saveAnnotation","getMaxScoreForComponent"],"mappings":"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","file":"vleController.js","sourcesContent":["'use strict';\n\nclass VLEController {\n  constructor(\n      $scope,\n      $rootScope,\n      $filter,\n      $mdDialog,\n      $mdMenu,\n      $state,\n      AnnotationService,\n      ConfigService,\n      NotebookService,\n      NotificationService,\n      ProjectService,\n      SessionService,\n      StudentDataService,\n      UtilService) {\n    this.$scope = $scope;\n    this.$rootScope = $rootScope;\n    this.$filter = $filter;\n    this.$mdDialog = $mdDialog;\n    this.$mdMenu = $mdMenu;\n    this.$state = $state;\n    this.AnnotationService = AnnotationService;\n    this.ConfigService = ConfigService;\n    this.NotebookService = NotebookService;\n    this.NotificationService = NotificationService;\n    this.ProjectService = ProjectService;\n    this.SessionService = SessionService;\n    this.StudentDataService = StudentDataService;\n    this.UtilService = UtilService;\n    this.$translate = this.$filter('translate');\n\n    this.workgroupId = this.ConfigService.getWorkgroupId();\n    this.currentNode = null;\n    this.pauseDialog = null;\n    this.noteDialog = null;\n\n    this.navFilters = this.ProjectService.getFilters();\n    this.navFilter = this.navFilters[0].name;\n\n    this.projectStyle = this.ProjectService.getStyle();\n    this.projectName = this.ProjectService.getProjectTitle();\n    this.totalScore = this.StudentDataService.getTotalScore();\n    this.maxScore = this.StudentDataService.maxScore;\n    this.notebookEnabled = this.NotebookService.isNotebookEnabled();\n\n    this.notebookConfig = this.NotebookService.getNotebookConfig();\n    // Get report, if enabled; assume only one report for now\n    this.reportItem = this.notebookConfig.itemTypes.report.notes[0];\n\n    this.constraintsDisabled = false;\n\n    let userType = this.ConfigService.getConfigParam('userType');\n    let contextPath = this.ConfigService.getConfigParam('contextPath');\n    if (userType == 'student') {\n      this.homePath = contextPath + '/student';\n    } else  if (userType == 'teacher') {\n      this.homePath = contextPath + '/teacher';\n    } else {\n      this.homePath = contextPath;\n    }\n\n    if (this.ConfigService.getConfigParam('constraints') == false) {\n      this.constraintsDisabled = true;\n    }\n\n    let script = this.ProjectService.getProjectScript();\n    if (script != null) {\n      this.ProjectService.retrieveScript(script).then((script) => {\n        new Function(script).call(this);\n      });\n    }\n\n    this.$scope.$on('currentNodeChanged', (event, args) => {\n      let previousNode = args.previousNode;\n      let currentNode = this.StudentDataService.getCurrentNode();\n      let currentNodeId = currentNode.id;\n\n      this.StudentDataService.updateStackHistory(currentNodeId);\n      this.StudentDataService.updateVisitedNodesHistory(currentNodeId);\n\n      this.$state.go('root.vle', {nodeId:currentNodeId});\n\n      let componentId, componentType, category, eventName, eventData, eventNodeId;\n      if (previousNode != null && this.ProjectService.isGroupNode(previousNode.id)) {\n        // going from group to node or group to group\n        componentId = null;\n        componentType = null;\n        category = \"Navigation\";\n        eventName = \"nodeExited\";\n        eventData = {\n          nodeId: previousNode.id\n        };\n        eventNodeId = previousNode.id;\n        this.StudentDataService.saveVLEEvent(eventNodeId, componentId, componentType, category, eventName, eventData);\n      }\n\n      if (this.ProjectService.isGroupNode(currentNodeId)) {\n        componentId = null;\n        componentType = null;\n        category = \"Navigation\";\n        eventName = \"nodeEntered\";\n        eventData = {\n          nodeId: currentNode.id\n        };\n        eventNodeId = currentNode.id;\n        this.StudentDataService.saveVLEEvent(eventNodeId, componentId, componentType, category, eventName, eventData);\n      }\n    });\n\n    this.notifications = this.NotificationService.notifications;\n    this.$scope.$watch(\n      () => {\n        return this.NotificationService.notifications.length;\n      },\n      (newValue, oldValue) => {\n        this.notifications = this.NotificationService.notifications;\n        this.newNotifications = this.getNewNotifications();\n      }\n    );\n\n    this.$scope.$on('notificationChanged', (event, notification) => {\n      // update new notifications\n      this.notifications = this.NotificationService.notifications;\n      this.newNotifications = this.getNewNotifications();\n    });\n\n    this.$scope.$on('componentStudentDataChanged', () => {\n\n    });\n\n    this.$scope.$on('pauseScreen', (event, args) => {\n      this.pauseScreen();\n    });\n\n    this.$scope.$on('unPauseScreen', (event, args) => {\n      this.unPauseScreen();\n    });\n\n    this.$scope.$on('requestImageCallback', (event, args) => {\n      if (this.snippableItems == null) {\n        this.snippableItems = [];\n      }\n\n      if (args.imageObject != null) {\n        this.snippableItems.push(args.imageObject);\n      }\n\n      if (args.imageObjects != null) {\n        for (const imageObject of args.imageObjects) {\n          if (imageObject != null) {\n            this.snippableItems.push(imageObject);\n          }\n        }\n      }\n    });\n\n    // Make sure if we drop something on the page we don't navigate away\n    // https://developer.mozilla.org/En/DragDrop/Drag_Operations#drop\n    $(document.body).on('dragover', function(e) {\n      e.preventDefault();\n      return false;\n    });\n\n    $(document.body).on('drop', function(e){\n      e.preventDefault();\n      return false;\n    });\n\n    this.themePath = this.ProjectService.getThemePath();\n    this.notebookItemPath = this.themePath + '/notebook/notebookItem.html';\n\n    let nodeId = null;\n    let stateParams = null;\n    let stateParamNodeId = null;\n\n    if (this.$state != null) {\n      stateParams = this.$state.params;\n    }\n\n    if (stateParams != null) {\n      stateParamNodeId = stateParams.nodeId;\n    }\n\n    if (stateParamNodeId != null && stateParamNodeId !== '') {\n      nodeId = stateParamNodeId;\n    } else {\n      /*\n       * get the node id for the latest node entered event for an active\n       * node that exists in the project\n       */\n      nodeId = this.StudentDataService.getLatestNodeEnteredEventNodeIdWithExistingNode();\n    }\n\n    if (nodeId == null || nodeId === '') {\n      nodeId = this.ProjectService.getStartNodeId();\n    }\n\n    this.StudentDataService.setCurrentNodeByNodeId(nodeId);\n\n    const runStatus = this.StudentDataService.getRunStatus();\n    if (runStatus != null) {\n      let pause = false;\n      const periodId = this.ConfigService.getPeriodId();\n      if (periodId != null) {\n        const periods = runStatus.periods;\n        if (periods != null) {\n          for (const tempPeriod of periods) {\n            if (periodId === tempPeriod.periodId) {\n              if (tempPeriod.paused) {\n                pause = true;\n                break;\n              }\n            }\n          }\n        }\n      }\n\n      if (pause) {\n        this.pauseScreen();\n      }\n    }\n  }\n\n  // TODO: remove and use inline clipping (with guidance)\n  snipNewNote($event) {\n    // Ask all of the components on the page for snippable items\n    let templateUrl = this.themePath + '/notebook/contentSnipper.html';\n\n    let currentNodeId = this.StudentDataService.getCurrentNodeId();\n    let currentComponents = this.ProjectService.getComponentsByNodeId(currentNodeId);\n\n    /*\n     * initialize the snippable items array that will become populated\n     * with snippable items\n     */\n    this.snippableItems = [];\n\n    for (const currentComponent of currentComponents) {\n      const args = {};\n      args.nodeId = currentNodeId;\n      args.componentId = currentComponent.id;\n      this.$rootScope.$broadcast('requestImage', args);\n    }\n    this.$mdDialog.show({\n      parent: angular.element(document.body),\n      targetEvent: $event,\n      templateUrl: templateUrl,\n      clickOutsideToClose: true,\n      locals: {\n        snippableItems: this.snippableItems\n      },\n      controller: NotebookContentSnippetController,\n      controllerAs: 'notebookContentSnippetController',\n      bindToController: true\n    });\n    function NotebookContentSnippetController($rootScope, $scope, $mdDialog, snippableItems, NotebookService, StudentDataService, ProjectService) {\n      $scope.NotebookService = NotebookService;\n      $scope.StudentDataService = StudentDataService;\n      $scope.ProjectService = ProjectService;\n      $scope.snippableItems = snippableItems;\n\n      for (const snippableItem of snippableItems) {\n        if (snippableItem != null) {\n          /*\n           * create a local browser URL for the snippable item so\n           * we can display it as an image\n           */\n          snippableItem.url = URL.createObjectURL(snippableItem);\n        }\n      }\n\n      $scope.close = () => {\n        $mdDialog.hide();\n      };\n      $scope.chooseSnippet = (snippableItem) => {\n        $scope.NotebookService.addNewItem($event, snippableItem);\n        $mdDialog.hide();\n      };\n    }\n\n    NotebookContentSnippetController.$inject = [\"$rootScope\", \"$scope\", \"$mdDialog\", \"snippableItems\", \"NotebookService\", \"StudentDataService\", \"ProjectService\"];\n  }\n\n  goHome() {\n    const nodeId = null;\n    const componentId = null;\n    const componentType = null;\n    const category = \"Navigation\";\n    const event = \"goHomeButtonClicked\";\n    const eventData = {};\n    this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n\n    this.$rootScope.$broadcast('goHome');\n  };\n\n  logOut() {\n    const nodeId = null;\n    const componentId = null;\n    const componentType = null;\n    const category = \"Navigation\";\n    const event = \"logOutButtonClicked\";\n    const eventData = {};\n    this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n\n    this.$rootScope.$broadcast('logOut');\n  };\n\n  loadRoot() {\n    this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(this.ProjectService.rootNode.id);\n  };\n\n  /**\n   * The user moved the mouse on the page\n   */\n  mouseMoved() {\n    // tell the session service a mouse event occurred\n    // so it can reset the session timeout timers\n    this.SessionService.mouseEventOccurred();\n  };\n\n  /**\n   * Returns true iff there are new notifications\n   */\n  hasNewNotifications() {\n    return this.newNotifications.length > 0;\n  }\n\n  /**\n   * Returns true iff there are new notifications of type 'ambient'\n   */\n  hasNewAmbientNotifications() {\n    return this.getNewAmbientNotifications().length > 0;\n  }\n\n  /**\n   * Returns all notifications that have not been dismissed yet\n   * The newNotifications is an array of notification aggregate objects that looks like this:\n   * [\n   *  {\n     *    \"nodeId\": \"node2\",\n     *    \"type\": \"DiscussionReply\",   // [\"DiscussionReply\", \"teacherToStudent\"]\n     *    \"notifications\": [{ id: 1117} , { id: 1120 }]      // array of actual undismissed notifications with this nodeId and type\n     *  },\n   *  ...\n   * ]\n   * The annotation aggregates will be sorted by latest first -> oldest last\n   */\n  getNewNotifications() {\n    let newNotificationAggregates = [];\n    for (let notification of this.notifications) {\n      if (notification.timeDismissed == null) {\n        let notificationNodeId = notification.nodeId;\n        let notificationType = notification.type;\n        let newNotificationForNodeIdAndTypeExists = false;\n        for (let newNotificationAggregate of newNotificationAggregates) {\n          if (newNotificationAggregate.nodeId == notificationNodeId && newNotificationAggregate.type == notificationType) {\n            newNotificationForNodeIdAndTypeExists = true;\n            newNotificationAggregate.notifications.push(notification);\n            if (notification.timeGenerated > newNotificationAggregate.latestNotificationTimestamp) {\n              newNotificationAggregate.latestNotificationTimestamp = notification.timeGenerated;\n            }\n          }\n        }\n        let notebookItemId = null;  // if this notification was created because teacher commented on a notebook report.\n        if (!newNotificationForNodeIdAndTypeExists) {\n          let message = \"\";\n          if (notificationType === \"DiscussionReply\") {\n            message = this.$translate('newRepliesOnDiscussionPost');\n          } else if (notificationType === \"teacherToStudent\") {\n            message = this.$translate('newFeedbackFromTeacher');\n            if (notification.data != null) {\n              if (typeof notification.data === 'string') {\n                notification.data = angular.fromJson(notification.data);\n              }\n\n              if (notification.data.annotationId != null) {\n                let annotation = this.AnnotationService.getAnnotationById(notification.data.annotationId);\n                if (annotation != null && annotation.notebookItemId != null) {\n                  notebookItemId = annotation.notebookItemId;\n                }\n              }\n            }\n          } else if (notificationType === \"CRaterResult\") {\n            message = this.$translate('newFeedback');\n          }\n          let newNotificationAggregate = {\n            latestNotificationTimestamp: notification.timeGenerated,\n            message: message,\n            nodeId: notificationNodeId,\n            notebookItemId: notebookItemId,\n            notifications: [notification],\n            type: notificationType\n          };\n          newNotificationAggregates.push(newNotificationAggregate);\n        }\n      }\n    }\n\n    // sort the aggregates by latestNotificationTimestamp, latest -> oldest\n    newNotificationAggregates.sort((n1, n2) => {\n      return n2.latestNotificationTimestamp - n1.latestNotificationTimestamp;\n    });\n    return newNotificationAggregates;\n  }\n\n  /**\n   * Returns all ambient notifications that have not been dismissed yet\n   */\n  getNewAmbientNotifications() {\n    return this.notifications.filter(\n      function(notification) {\n        let isAmbient = notification.data ? notification.data.isAmbient : false;\n        return (notification.timeDismissed == null && isAmbient);\n      }\n    );\n  }\n\n  /**\n   * Dismiss the specified notification\n   * @param notification\n   */\n  dismissNotification(event, notification) {\n    if (notification.data == null || notification.data.dismissCode == null) {\n      this.NotificationService.dismissNotification(notification);\n    } else {\n      // ask user to input dimiss code before dimissing it\n      let args = {\n        event: event,\n        notification: notification\n      };\n      this.$rootScope.$broadcast('viewCurrentAmbientNotification', args);\n      this.$mdMenu.hide();\n    }\n  }\n\n  /**\n   * View the most recent ambient notification and allow teacher to input\n   * dismiss code\n   */\n  viewCurrentAmbientNotification(event) {\n    let ambientNotifications = this.getNewAmbientNotifications();\n    if (ambientNotifications.length) {\n      let currentNotification = ambientNotifications[0];\n      let args = {};\n      args.event = event;\n      args.notification = currentNotification;\n      this.$rootScope.$broadcast('viewCurrentAmbientNotification', args);\n    }\n  }\n\n  /**\n   * Dismiss the notification aggregate object, which effectively dismisses all notifications\n   * for the nodeId and type of the aggregate object.\n   * @param event\n   * @param notificationAggregate\n   */\n  dismissNotificationAggregate(event, notificationAggregate) {\n    if (notificationAggregate != null && notificationAggregate.notifications != null) {\n      for (let notification of notificationAggregate.notifications) {\n        this.dismissNotification(event, notification);\n      }\n    }\n  };\n\n  /**\n   * Dismiss the specified notification aggregate object and visit the node\n   * @param notificationAggregate, which contains nodeId, type, and notifications of that nodeId and type\n   */\n  dismissNotificationAggregateAndVisitNode(event, notificationAggregate) {\n    if (notificationAggregate != null && notificationAggregate.notifications != null) {\n      for (let notification of notificationAggregate.notifications) {\n        if (notification.data == null || notification.data.dismissCode == null) {\n          // only dismiss notifications that don't require a dismiss code,\n          // but still allow them to move to the node\n          this.dismissNotification(event, notification);\n        }\n      }\n    }\n\n    let goToNodeId = notificationAggregate.nodeId;\n    let notebookItemId = notificationAggregate.notebookItemId;\n    if (goToNodeId != null) {\n      this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(goToNodeId);\n    } else if (notebookItemId != null) {\n      // assume notification with notebookItemId is for the report for now,\n      // as we don't currently support annotations on notes\n      this.$rootScope.$broadcast('showReportAnnotations', {ev: event});\n    }\n  }\n\n  pauseScreen() {\n    // TODO: i18n\n    this.pauseDialog = this.$mdDialog.show({\n      template: '<md-dialog aria-label=\"Screen Paused\"><md-dialog-content><div class=\"md-dialog-content\">' + this.$translate('yourTeacherHasPausedAllTheScreensInTheClass') + '</div></md-dialog-content></md-dialog>',\n      escapeToClose: false\n    });\n  }\n\n  unPauseScreen() {\n    this.$mdDialog.hide( this.pauseDialog, \"finished\" );\n    this.pauseDialog = undefined;\n  }\n\n  isPreview() {\n    return this.ConfigService.isPreview();\n  }\n\n  /**\n   * Check if there are any constraints in the project\n   * @return whether there are any constraints in the project\n   */\n  hasConstraints() {\n    let hasActiveConstraints = false;\n    const activeConstraints = this.ProjectService.activeConstraints;\n    if (activeConstraints != null && activeConstraints.length > 0) {\n      hasActiveConstraints = true;\n    }\n    return hasActiveConstraints;\n  }\n\n  /**\n   * Disable all the constraints\n   */\n  disableConstraints() {\n    if (this.ConfigService.isPreview()) {\n      this.constraintsDisabled = true;\n      this.ProjectService.activeConstraints = [];\n      /*\n       * update the node statuses so that they are re-evaluated now that\n       * all the constraints have been removed\n       */\n      this.StudentDataService.updateNodeStatuses();\n    }\n  }\n\n  /**\n   * Returns WISE API\n   */\n  getWISEAPI() {\n    return {\n      /**\n       * Registers a function that will be invoked before the componentState is saved to the server\n       * @param nodeId the node id\n       * @param componentId the component id\n       * @param additionalProcessingFunction the function to register for the specified node and component\n       */\n      registerAdditionalProcessingFunction: (nodeId, componentId, additionalProcessingFunction) => {\n        this.ProjectService.addAdditionalProcessingFunction(nodeId, componentId, additionalProcessingFunction);\n      },\n      /**\n       * Create an auto score annotation\n       * @param runId the run id\n       * @param periodId the period id\n       * @param nodeId the node id\n       * @param componentId the component id\n       * @param toWorkgroupId the student workgroup id\n       * @param data the annotation data\n       * @returns the auto score annotation\n       */\n      createAutoScoreAnnotation: (nodeId, componentId, data) => {\n        let runId = this.ConfigService.getRunId();\n        let periodId = this.ConfigService.getPeriodId();\n        let toWorkgroupId = this.ConfigService.getWorkgroupId();\n\n        return this.AnnotationService.createAutoScoreAnnotation(\n            runId, periodId, nodeId, componentId, toWorkgroupId, data);\n      },\n      /**\n       * Create an auto comment annotation\n       * @param runId the run id\n       * @param periodId the period id\n       * @param nodeId the node id\n       * @param componentId the component id\n       * @param toWorkgroupId the student workgroup id\n       * @param data the annotation data\n       * @returns the auto comment annotation\n       */\n      createAutoCommentAnnotation: (nodeId, componentId, data) => {\n        let runId = this.ConfigService.getRunId();\n        let periodId = this.ConfigService.getPeriodId();\n        let toWorkgroupId = this.ConfigService.getWorkgroupId();\n\n        return this.AnnotationService.createAutoCommentAnnotation(\n            runId, periodId, nodeId, componentId, toWorkgroupId, data);\n      },\n      /**\n       * Gets the latest annotation for the specified node, component, and type\n       * @param nodeId\n       * @param componentId\n       * @param annotationType\n       * @returns {the|Object}\n       */\n      getLatestAnnotationForComponent: (nodeId, componentId, annotationType) => {\n        let params = {\n          \"nodeId\": nodeId,\n          \"componentId\": componentId,\n          \"type\": annotationType\n        };\n        return this.AnnotationService.getLatestAnnotation(params);\n      },\n      /**\n       * Updates the annotation locally and on the server\n       * @param annotation\n       */\n      updateAnnotation: (annotation) => {\n        this.AnnotationService.saveAnnotation(annotation);\n      },\n      /**\n       * Returns the maxScore for the specified node and component\n       * @param nodeId the node id\n       * @param componentId the component id\n       * @returns the max score for the component\n       */\n      getMaxScoreForComponent: (nodeId, componentId) => {\n        return this.ProjectService.getMaxScoreForComponent(nodeId, componentId);\n      }\n    }\n  }\n}\n\nVLEController.$inject = [\n  '$scope',\n  '$rootScope',\n  '$filter',\n  '$mdDialog',\n  '$mdMenu',\n  '$state',\n  'AnnotationService',\n  'ConfigService',\n  'NotebookService',\n  'NotificationService',\n  'ProjectService',\n  'SessionService',\n  'StudentDataService',\n  'UtilService'\n];\n\nexport default VLEController;\n"]}