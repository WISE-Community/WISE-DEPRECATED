<style>
  .componentTypeSelected {
    border-style: solid;
    border-color: black;
  }
  .bodyDiv {
    margin-left: 10px;
  }
  .criteriaContent {
    margin-left: 30px;
  }
  .advancedAuthoringDiv {
    border: 2px solid black;
    padding: 20px;
  }
  .advancedAuthoringDiv > div {
      padding: 5px 20px;
  }
</style>
<div style='background-color: white; position: sticky; top: 17px; z-index: 2;'>
  <md-button id='backToProjectButton' class='topButton md-raised md-primary'
      ng-click='nodeAuthoringController.backButtonClicked()'
      ng-disabled='nodeAuthoringController.insertComponentMode'>
    <md-icon>arrow_back</md-icon>
    <md-tooltip md-direction='top'
        class='projectButtonTooltip'
        ng-if='nodeAuthoringController.showStepButtons'>
      {{ ::'backToProjectView' | translate }}
    </md-tooltip>
    <md-tooltip md-direction='top'
        class='projectButtonTooltip'
        ng-if='!nodeAuthoringController.showStepButtons'>
      {{ ::'backToStepView' | translate }}
    </md-tooltip>
  </md-button>
  <md-button id='addComponentButton'
         ng-if='nodeAuthoringController.showStepButtons && !projectController.isGroupNode(nodeAuthoringController.node.id)'
         class='topButton md-raised md-primary'
         ng-click='nodeAuthoringController.addComponentButtonClicked()'
         ng-disabled='nodeAuthoringController.getSelectedComponentIds().length != 0 || nodeAuthoringController.insertComponentMode'>
    <md-icon>add</md-icon>
    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'addNewComponent' | translate }}</md-tooltip>
  </md-button>
  <md-button id='importComponentButton'
      ng-if='nodeAuthoringController.showStepButtons && !projectController.isGroupNode(nodeAuthoringController.node.id)'
      class='topButton md-raised md-primary'
      ng-click='nodeAuthoringController.importButtonClicked()'
      ng-disabled='nodeAuthoringController.getSelectedComponentIds().length != 0 || nodeAuthoringController.insertComponentMode'>
    <md-icon>system_update_alt</md-icon>
    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'importComponent' | translate }}</md-tooltip>
  </md-button>
  <md-button id='moveComponentButton'
      ng-if='nodeAuthoringController.showStepButtons && !projectController.isGroupNode(nodeAuthoringController.node.id)'
      class='topButton md-raised md-primary'
      ng-click='nodeAuthoringController.moveButtonClicked()'
      ng-disabled='nodeAuthoringController.insertComponentMode'>
    <md-icon>redo</md-icon>
    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'move' | translate }}</md-tooltip>
  </md-button>
  <md-button id='copyComponentButton'
      ng-if='nodeAuthoringController.showStepButtons && !projectController.isGroupNode(nodeAuthoringController.node.id)'
      class='topButton md-raised md-primary'
      ng-click='nodeAuthoringController.copyButtonClicked()'
      ng-disabled='nodeAuthoringController.insertComponentMode'>
    <md-icon>content_copy</md-icon>
    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'copy' | translate }}</md-tooltip>
  </md-button>
  <md-button id='deleteComponentButton'
      ng-if='nodeAuthoringController.showStepButtons && !projectController.isGroupNode(nodeAuthoringController.node.id)'
      class='topButton md-raised md-primary'
      ng-click='nodeAuthoringController.deleteButtonClicked()'
      ng-disabled='nodeAuthoringController.insertComponentMode'>
    <md-icon>delete</md-icon>
    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'DELETE' | translate }}</md-tooltip>
  </md-button>
  <md-button id='editStepRubricButton' class='topButton md-raised md-primary'
         ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("editRubric")'
         ng-disabled='nodeAuthoringController.getSelectedComponentIds().length != 0 || nodeAuthoringController.insertComponentMode'
         ng-if='nodeAuthoringController.showStepButtons'>
    <md-icon>message</md-icon>
    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'editStepRubric' | translate }}</md-tooltip>
  </md-button>
  <md-button id='stepAdvancedButton' class='topButton md-raised md-primary'
         ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("advanced")'
         ng-disabled='nodeAuthoringController.getSelectedComponentIds().length != 0 || nodeAuthoringController.insertComponentMode'
         ng-if='nodeAuthoringController.showStepButtons'>
    <md-icon>build</md-icon>
    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'ADVANCED' | translate }}</md-tooltip>
  </md-button>
  <md-button id='stepUndoButton' class='topButton md-raised md-primary' ng-click='nodeAuthoringController.undo()'
      ng-if='!projectController.isGroupNode(nodeAuthoringController.node.id) && nodeAuthoringController.showStepButtons'
      ng-disabled='nodeAuthoringController.getSelectedComponentIds().length != 0 || nodeAuthoringController.undoStack.length == 0 || nodeAuthoringController.insertComponentMode'>
    <md-icon>undo</md-icon>
    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'undo' | translate }}</md-tooltip>
  </md-button>
  <div ng-if="nodeAuthoringController.showAdvanced"
      style="display: inline;">
    <md-button ng-if='!projectController.isGroupNode(nodeAuthoringController.node.id)'
           class='topButton md-raised md-primary'
           ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("generalAdvanced")'
           ng-disabled='nodeAuthoringController.insertComponentMode'>
      <md-icon>settings</md-icon>
      <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'generalAdvanced' | translate }}</md-tooltip>
    </md-button>
    <md-button ng-if='!projectController.isGroupNode(nodeAuthoringController.node.id)'
           class='topButton md-raised md-primary'
           ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("editTransitions")'
           ng-disabled='nodeAuthoringController.insertComponentMode'>
      <md-icon>trending_up</md-icon>
      <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'editTransitions' | translate }}</md-tooltip>
    </md-button>
    <md-button ng-if='!projectController.isGroupNode(nodeAuthoringController.node.id)'
           class='topButton md-raised md-primary'
           ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("editConstraints")'
           ng-disabled='nodeAuthoringController.insertComponentMode'>
      <md-icon>block</md-icon>
      <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'editConstraints' | translate }}</md-tooltip>
    </md-button>
    <md-button ng-if='!projectController.isGroupNode(nodeAuthoringController.node.id)'
           class='topButton md-raised md-primary'
           ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("createBranch")'
           ng-disabled='nodeAuthoringController.insertComponentMode'>
      <md-icon style='transform: rotate(180deg);'>call_split</md-icon>
      <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'createBranch' | translate }}</md-tooltip>
    </md-button>
    <md-button class='topButton md-raised md-primary'
           ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("showJSON")'
           ng-disabled='nodeAuthoringController.insertComponentMode'>
      <md-icon>code</md-icon>
      <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'showJSON' | translate }}</md-tooltip>
    </md-button>
    </div>
  <div style="float:right">
    <md-button id='stepPreviewButton' class='topButton md-raised md-primary' ng-click='nodeAuthoringController.previewStepInNewWindow()'
        ng-if='!projectController.isGroupNode(nodeAuthoringController.node.id)'
        ng-disabled='nodeAuthoringController.showEditTransitions || nodeAuthoringController.insertComponentMode'>
      <md-icon>visibility</md-icon>
      <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'previewStep' | translate }}</md-tooltip>
    </md-button>
    <md-button id='stepPreviewWithouConstraintsButton' class='topButton md-raised md-primary' ng-click="nodeAuthoringController.previewStepWithoutConstraintsInNewWindow()"
        ng-if='!projectController.isGroupNode(nodeAuthoringController.node.id)'
        ng-disabled='nodeAuthoringController.showEditTransitions || nodeAuthoringController.insertComponentMode'>
      <md-icon>visibility_off</md-icon>
      <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'previewStepWithoutConstraints' | translate }}</md-tooltip>
    </md-button>
  </div>
  <div ng-if='nodeAuthoringController.showCreateComponent' layout='row' style='margin-left: 10px;'>
    <div layout='row'>
      <h6>{{ ::'clickTheNewComponentTypeYouWantToAdd' | translate }}</h6>
      <md-button class='createButton md-raised md-primary'
             ng-click='nodeAuthoringController.cancelCreateComponentClicked()'
             aria-label="{{ ::'CANCEL' | translate }}"
             translate="CANCEL">
      </md-button>
    </div>
  </div>
  <div ng-if='nodeAuthoringController.showCreateComponent'>
    <md-grid-list md-cols-xs='1' md-cols-sm='2' md-cols-md='4' md-cols-gt-md='7' md-row-height='30'>
      <md-grid-tile ng-repeat='componentType in nodeAuthoringController.componentTypes'
              style='outline: none; cursor: pointer;'
              ng-mousedown='nodeAuthoringController.componentTypeClicked(componentType.componentType)'
              ng-class='{ componentTypeSelected: componentType.componentType == nodeAuthoringController.selectedComponent }'>
        {{componentType.componentName}}
      </md-grid-tile>
    </md-grid-list>
  </div>
  <div ng-if='nodeAuthoringController.showAdvanced' style='margin-top: 10px;'>
    <div ng-if='nodeAuthoringController.showGeneralAdvanced' class='bodyDiv'>
      <div>
        <md-checkbox class='md-primary'
               ng-model='nodeAuthoringController.node.showSaveButton'
               ng-change='nodeAuthoringController.authoringViewNodeChanged()'>
          {{ ::'SHOW_SAVE_BUTTON' | translate }}
        </md-checkbox>
      </div>
      <div>
        <md-checkbox class='md-primary'
               ng-model='nodeAuthoringController.node.showSubmitButton'
               ng-change='nodeAuthoringController.authoringViewNodeChanged()'>
          {{ ::'SHOW_SUBMIT_BUTTON' | translate }}
        </md-checkbox>
      </div>
    </div>
    <div ng-if='nodeAuthoringController.showEditTransitions' class='bodyDiv'>
      <div>
        <label class='node__label--vertical-alignment'>{{ ::'paths' | translate }}</label>
        <md-button class='topButton md-raised md-primary'
               ng-click='nodeAuthoringController.addNewTransition()'>
          <md-icon>add</md-icon>
          <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'addAPath' | translate }}</md-tooltip>
        </md-button>
      </div>
      <div ng-if='nodeAuthoringController.node.transitionLogic == null || nodeAuthoringController.node.transitionLogic.transitions == 0'>
        {{ ::'thereAreNotPathsOutOfThisStep' | translate }}
      </div>
      <div ng-repeat='(transitionIndex, transition) in nodeAuthoringController.node.transitionLogic.transitions'
         style='border: 2px solid #dddddd; border-radius: 5px; margin-bottom: 10px; padding: 20px 20px 10px 20px;'>
        <div style='margin-top: -10px; margin-bottom: 10px;'>
          <label class='node__label--vertical-alignment'>{{ ::'path' | translate }} {{ transitionIndex + 1 }}</label>
          <md-button class='topButton md-raised md-primary'
                 ng-click='nodeAuthoringController.deleteTransition(transition)'>
            <md-icon>delete</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'deleteTransition' | translate }}</md-tooltip>
          </md-button>
        </div>
        <div flex>
          <md-input-container>
            <label>{{ ::'transitionToStep' | translate }}</label>
            <md-select id='stepSelectMenu'
                   md-theme='default'
                   class='node-select md-subhead'
                   ng-model='transition.to'
                   ng-change='nodeAuthoringController.authoringViewTransitionToNodeIdChanged()'
                   aria-label='Transitions' style='width:600px'>
              <md-option ng-repeat='item in projectController.items | toArray | orderBy : "order"'
                     value='{{ ::item.$key }}'
                     ng-if='item.$key != "group0"'
                     ng-class='{"node-select-option--group": projectController.isGroupNode(item.$key), "node-select-option--node": !projectController.isGroupNode(item.$key)}'>
                <span layout='row' layout-align='start center'>
                  <span class='node-select__text'>{{ ::projectController.getNodePositionById(item.$key) + ': '}}{{ ::projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                  <node-status-icon node-id='item.$key' custom-class='"node-select__status"'></node-status-icon>
                </span>
              </md-option>
            </md-select>
          </md-input-container>
        </div>
        <div>
          <div>
            <label class='node__label--vertical-alignment'>{{ ::'requirements' | translate }}</label>
            <md-button class='topButton md-raised md-primary'
                   ng-click='nodeAuthoringController.addNewTransitionCriteria(transition)'>
              <md-icon>add</md-icon>
              <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'addARequirementForThePath' | translate }}</md-tooltip>
            </md-button>
          </div>
          <div ng-if='transition.criteria == null || transition.criteria.length == 0'
             class='criteriaContent'>
            {{ ::'thereAreNoRequirementsForThisTransition' | translate }}
          </div>
          <div ng-repeat='(criteriaIndex, transitionCriteria) in transition.criteria'>
            <div class='criteriaContent'>
              <md-input-container>
                <label>The student needs to</label>
                <md-select ng-model='transitionCriteria.name'
                       ng-change='nodeAuthoringController.transitionCriteriaNameChanged(transitionCriteria)'
                       class='node-select md-subhead'
                       style='width:400px'>
                  <md-option ng-repeat='availableTransitionCriteriaName in nodeAuthoringController.transitionCriterias'
                         ng-value='availableTransitionCriteriaName.value'>
                  <span layout='row' layout-align='start center'>
                     <span class='node-select__text'>{{::availableTransitionCriteriaName.text}}</span>
                  </span>
                  </md-option>
                </md-select>
              </md-input-container>
              <md-input-container>
                <md-button class='topButton md-raised md-primary'
                       ng-click='nodeAuthoringController.deleteTransitionCriteria(transition, criteriaIndex)'>
                  <md-icon>delete</md-icon>
                  <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'deleteThisRequirement' | translate }}</md-tooltip>
                </md-button>
              </md-input-container>
            </div>
            <div ng-repeat='param in nodeAuthoringController.getTransitionCriteriaParamsByName(transitionCriteria.name)'
               class='criteriaContent'>
              <md-input-container ng-if='param.value == "nodeId"'>
                <label>{{ ::param.text }}</label>
                <md-select id="nodeIdSelectMenu"
                       md-theme="default"
                       class='node-select md-subhead'
                       ng-model="transitionCriteria.params.nodeId"
                       ng-change='nodeAuthoringController.transitionCriteriaNodeIdChanged(transitionCriteria)'
                       aria-label="TransitionCriteriaNode"
                       style="width:600px">
                  <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                         ng-if='item.$key != "group0"'
                         value="{{ item.$key }}"
                         ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
                  <span layout="row" layout-align="start center">
                    <span class="node-select__text">{{ ::projectController.getNodePositionById(item.$key) + ': '}}{{ ::projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                    <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
                  </span>
                  </md-option>
                </md-select>
              </md-input-container>
              <md-input-container ng-if='param.value == "componentId"'>
                <label>{{ ::param.text }}</label>
                <md-select id="componentIdSelectMenu"
                       md-theme="default"
                       class='node-select md-subhead'
                       ng-model="transitionCriteria.params.componentId"
                       ng-change='nodeAuthoringController.transitionCriteriaComponentIdChanged(transitionCriteria)'
                       aria-label="TransitionCriteriaComponent"
                       style="width:600px">
                  <md-option ng-repeat="(componentIndex, component) in projectController.getComponentsByNodeId(transitionCriteria.params.nodeId)"
                         ng-disabled='transitionCriteria.name == "choiceChosen" && component.type != "MultipleChoice"'
                         value="{{ component.id }}">
                  <span layout="row" layout-align="start center">
                    <span class="node-select__text">{{ ::(componentIndex + 1) }}. {{ ::component.type }} ({{ ::component.id }})</span>
                  </span>
                  </md-option>
                </md-select>
              </md-input-container>
              <md-input-container ng-if='param.value == "scores"'>
                <label>{{ ::param.text }}</label>
                <input type='text'
                     ng-model='transitionCriteria.params.scores'
                     ng-model-options='{ debounce: 1000 }'
                     ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                     ng-list=','/>
              </md-input-container>
              <md-input-container ng-if='param.value == "choiceIds" && nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(transitionCriteria.params.nodeId, transitionCriteria.params.componentId) == "radio"'>
                <label>{{ ::'theStudentNeedsToChooseThisChoice' | translate }}</label>
                <md-select id="radioChoiceIdsSelectMenu"
                       md-theme="default"
                       class='node-select md-subhead'
                       ng-model="transitionCriteria.params.choiceIds"
                       ng-list
                       ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                       aria-label="TransitionCriteriaNode"
                       style="width:600px">
                  <md-optgroup>
                    <md-option ng-value="choice.id" ng-repeat="choice in nodeAuthoringController.getChoicesByNodeIdAndComponentId(transitionCriteria.params.nodeId, transitionCriteria.params.componentId)">{{choice.text}}</md-option>
                  </md-optgroup>
                </md-select>
              </md-input-container>
              <md-input-container ng-if='param.value == "choiceIds" && nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(transitionCriteria.params.nodeId, transitionCriteria.params.componentId) == "checkbox"'>
                <label>{{ ::'theStudentNeedsToChooseTheseChoices' | translate }}</label>
                <md-select id="checkboxChoiceIdsSelectMenu"
                       md-theme="default"
                       class='node-select md-subhead'
                       ng-model="transitionCriteria.params.choiceIds"
                       ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                       aria-label="TransitionCriteriaNode"
                       style="width:600px"
                       multiple={{nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(transitionCriteria.params.nodeId, transitionCriteria.params.componentId)}}>
                  <md-optgroup>
                    <md-option ng-value="choice.id" ng-repeat="choice in nodeAuthoringController.getChoicesByNodeIdAndComponentId(transitionCriteria.params.nodeId, transitionCriteria.params.componentId)">{{choice.text}}</md-option>
                  </md-optgroup>
                </md-select>
              </md-input-container>
            </div>
          </div>
        </div>
      </div>
      <div ng-if='nodeAuthoringController.node.transitionLogic.transitions.length > 1'>
        <md-input-container id='howToChooseAmongAvailablePaths'>
          <label>{{ ::'howToChooseAmongAvailablePaths' | translate }}</label>
          <md-select id='howToChooseAmongAvailablePathsSelect'
                 ng-disabled='nodeAuthoringController.node.transitionLogic.transitions.length <= 1'
                 md-theme='default'
                 class='node-select md-subhead'
                 ng-model='nodeAuthoringController.node.transitionLogic.howToChooseAmongAvailablePaths'
                 ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                 aria-label='howToChooseAmongAvailablePaths'
                 style='width: 600px'>
            <md-option ng-repeat='item in nodeAuthoringController.howToChooseAmongAvailablePathsOptions'
                   value='{{ item }}'>
              <span layout='row' layout-align='start center'>
                <span class='node-select__text'>{{item}}</span>
              </span>
            </md-option>
          </md-select>
        </md-input-container>
        <md-input-container id='whenToChoosePath'>
          <label>{{ ::'whenToChoosePath' | translate }}</label>
          <md-select id='whenToChoosePathSelect'
                 ng-disabled='nodeAuthoringController.node.transitionLogic.transitions.length <= 1'
                 md-theme='default'
                 class='node-select md-subhead'
                 ng-model='nodeAuthoringController.node.transitionLogic.whenToChoosePath'
                 ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                 aria-label='whenToChoosePath'
                 style='width: 600px'>
            <md-option ng-repeat='item in nodeAuthoringController.whenToChoosePathOptions'
                   value='{{ item }}'>
              <span layout='row' layout-align='start center'>
                <span class='node-select__text'>{{item}}</span>
              </span>
            </md-option>
          </md-select>
        </md-input-container>
        <md-input-container id='canChangePath'>
          <label>{{ ::'canChangePath' | translate }}</label>
          <md-select id='canChangePathSelect'
                 ng-disabled='nodeAuthoringController.node.transitionLogic.transitions.length <= 1'
                 md-theme='default'
                 class='node-select md-subhead'
                 ng-model='nodeAuthoringController.node.transitionLogic.canChangePath'
                 ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                 aria-label='canChangePath'
                 style='width: 600px'>
            <md-option ng-repeat='item in nodeAuthoringController.canChangePathOptions'
                   ng-value='{{ item }}'>
              <span layout='row' layout-align='start center'>
                <span class='node-select__text'>{{item}}</span>
              </span>
            </md-option>
          </md-select>
        </md-input-container>
        <br/>
        <md-input-container>
          <label>{{ ::'maxPathsVisitable' | translate }}</label>
          <input id='maxPathsVisitableSelect'
               type='number'
               ng-model='nodeAuthoringController.node.transitionLogic.maxPathsVisitable'
               ng-disabled='nodeAuthoringController.node.transitionLogic.transitions.length <= 1'
               ng-change='nodeAuthoringController.authoringViewNodeChanged()'
               ng-model-options='{ debounce: 1000 }'
               size='60' />
        </md-input-container>
      </div>
    </div>
    <div ng-if='nodeAuthoringController.showConstraints'
       class='bodyDiv'
       style='width: 700px;'>
      <div>
        <label class='node__label--vertical-alignment'>{{ ::'addConstraint' | translate }}</label>
        <md-button class='topButton md-raised md-primary'
                   ng-click='nodeAuthoringController.addConstraintAndScrollToBottom()'>
          <md-icon>add</md-icon>
          <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'addConstraint' | translate }}</md-tooltip>
        </md-button>
      </div>
      <div id={{constraint.id}}
           ng-repeat='constraint in nodeAuthoringController.node.constraints track by $index'
           style="border: 2px solid #dddddd; border-radius: 5px; margin-bottom: 10px; padding: 10px 20px 10px 20px;">
        <b>{{ ::'constraint' | translate }} {{ $index + 1 }}</b>
        <md-button class='topButton md-raised md-primary'
                   ng-click='nodeAuthoringController.deleteConstraint($index)'>
          <md-icon>delete</md-icon>
          <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'deleteConstraint' | translate }}</md-tooltip>
        </md-button>
        <br/>
        <div layout="row">
          <md-input-container>
            <label>{{ ::'action' | translate }}</label>
            <md-select ng-model='constraint.action'
                       ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                       class="node-select md-subhead"
                       style="width: 300px;">
              <md-option ng-repeat='action in nodeAuthoringController.constraintActions track by $index'
                         ng-value='action.value'>
                <span layout="row" layout-align="start center">
                  <span class="node-select__text" ng-style="$index == 0 && { 'color': 'red' }">{{action.text}}</span>
                </span>
              </md-option>
            </md-select>
          </md-input-container>
          <div style="width: 100px;"></div>
          <md-input-container>
            <label>{{ ::'removalConditional' | translate }}</label>
            <md-select ng-model='constraint.removalConditional'
                       ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                       class="node-select md-subhead"
                       style="width: 140px;">
              <md-option ng-repeat='availableRemovalConditional in nodeAuthoringController.removalConditionals'
                         ng-value='availableRemovalConditional.value'>
                <span layout="row" layout-align="start center">
                   <span class="node-select__text">{{availableRemovalConditional.text}}</span>
                </span>
              </md-option>
            </md-select>
          </md-input-container>
        </div>
        <div ng-repeat='criteria in constraint.removalCriteria'
             style="border: 2px solid #dddddd; border-radius: 5px; margin-top: 10px; margin-left: 50px; margin-bottom: 10px; padding: 10px 20px 10px 20px;">
          <b>{{ ::'removalCriteria' | translate }}</b>
          <md-button class='topButton md-raised md-primary'
                     ng-click='nodeAuthoringController.deleteRemovalCriteria(constraint, $index)'>
            <md-icon>delete</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'deleteRemovalCriteria' | translate }}</md-tooltip>
          </md-button>
          <br/>
          <md-input-container>
            <label>{{ ::'removalCriteriaName' | translate }}</label>
            <md-select ng-model='criteria.name'
                       ng-change='nodeAuthoringController.removalCriteriaNameChanged(criteria)'
                       class="node-select md-subhead"
                       style="width: 400px;">
              <md-option ng-repeat='availableRemovalCriteria in nodeAuthoringController.removalCriteria track by $index'
                         ng-value='availableRemovalCriteria.value'>
                <span layout="row" layout-align="start center">
                   <span class="node-select__text" ng-style="$index == 0 && { 'color': 'red' }">{{availableRemovalCriteria.text}}</span>
                </span>
              </md-option>
            </md-select>
          </md-input-container>
          <md-input-container ng-repeat='param in nodeAuthoringController.getRemovalCriteriaParamsByName(criteria.name)'>
            <label ng-if="param.value != 'requireAllCellsInARowToBeFilled' && param.value != 'tableHasHeaderRow'">{{::param.text}}</label>
            <md-select id="nodeIdSelectMenu"
                       ng-if='param.value == "nodeId"'
                       md-theme="default"
                       class="node-select md-subhead"
                       ng-model="criteria.params.nodeId"
                       ng-change='nodeAuthoringController.authoringViewConstraintRemovalCriteriaNodeIdChanged(criteria)'
                       aria-label="TransitionCriteriaNode"
                       style="width: 400px;">
              <md-option ng-value="''">
                <span layout="row" layout-align="start center">
                  <span class="node-select__text" style="color: red">{{ ::'pleaseChooseAStep' | translate }}</span>
                </span>
              </md-option>
              <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                         ng-if="item.$key != 'group0'"
                         ng-value="item.$key"
                         ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
                <span layout="row" layout-align="start center">
                  <span class="node-select__text">{{ ::projectController.getNodePositionById(item.$key) + ': '}}{{ ::projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                  <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
                </span>
              </md-option>
            </md-select>
            <md-select id="componentIdSelectMenu"
                       ng-if='param.value == "componentId"'
                       md-theme="default"
                       class="node-select md-subhead"
                       ng-model="criteria.params.componentId"
                       ng-change='nodeAuthoringController.authoringViewConstraintRemovalCriteriaComponentIdChanged(criteria)'
                       aria-label="TransitionCriteriaComponent"
                       style="width: 400px;">
              <md-option ng-value="''">
                <span layout="row" layout-align="start center">
                  <span class="node-select__text" style="color: red">{{ ::'pleaseChooseAComponent' | translate }}</span>
                </span>
              </md-option>
              <md-option ng-repeat="component in ::projectController.getComponentsByNodeId(criteria.params.nodeId) track by $index"
                         ng-value="component.id">
                <span layout="row" layout-align="start center">
                  <span class="node-select__text">{{::($index + 1)}}. {{::component.type}} ({{ ::'prompt' | translate }}: {{::component.prompt}})</span>
                </span>
              </md-option>
            </md-select>
            <md-select id="fromNodeIdSelectMenu"
                       ng-if='param.value == "fromNodeId"'
                       md-theme="default"
                       class="node-select md-subhead"
                       ng-model="criteria.params.fromNodeId"
                       ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                       aria-label="TransitionCriteriaNode"
                       style="width: 400px;">
              <md-option ng-value="''">
                <span layout="row" layout-align="start center">
                  <span class="node-select__text" style="color: red">{{ ::'pleaseSelectAFromStep' | translate }}</span>
                </span>
              </md-option>
              <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                         ng-value="item.$key"
                         ng-if="item.$key != 'group0'"
                         ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
                <span layout="row" layout-align="start center">
                  <span class="node-select__text">{{ ::projectController.getNodePositionById(item.$key) + ': '}}{{ ::projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                  <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
                </span>
              </md-option>
            </md-select>
            <md-select id="toNodeIdSelectMenu"
                       ng-if='param.value == "toNodeId"'
                       md-theme="default"
                       class="node-select md-subhead"
                       ng-model="criteria.params.toNodeId"
                       ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                       aria-label="TransitionCriteriaNode"
                       style="width: 400px;">
              <md-option ng-value="''">
                <span layout="row" layout-align="start center">
                  <span class="node-select__text" style="color: red">{{ ::'pleaseSelectAToStep' | translate }}</span>
                </span>
              </md-option>
              <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                         ng-if="item.$key != 'group0'"
                         ng-value="item.$key"
                         ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
                <span layout="row" layout-align="start center">
                  <span class="node-select__text">{{ ::projectController.getNodePositionById(item.$key) + ': '}}{{ ::projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                  <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
                </span>
              </md-option>
            </md-select>
            <input type='text'
                   ng-if='param.value == "scores"'
                   ng-model='criteria.params.scores'
                   ng-model-options='{ debounce: 1000 }'
                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                   ng-list=','/>
            <div ng-if='param.value == "scores" && criteria.params.scores == ""'><span style="color: red">{{ ::'pleaseEnterAScore' | translate }}</span></div>
            <input type='number'
                   ng-if='param.value == "requiredSubmitCount"'
                   ng-model='criteria.params.requiredSubmitCount'
                   ng-model-options='{ debounce: 1000 }'
                   style="width: 400px;"
                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'/>
            <div ng-if='param.value == "requiredSubmitCount" && (criteria.params.requiredSubmitCount == null || criteria.params.requiredSubmitCount == "")'><span style="color: red">{{ ::'pleaseEnterTheRequiredNumberOfSubmits' | translate }}</span></div>
            <md-select id="radioChoiceIdsSelectMenu"
                       ng-if='param.value == "choiceIds" && "radio" == nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(criteria.params.nodeId, criteria.params.componentId)'
                       md-theme="default"
                       class="node-select md-subhead"
                       ng-model="criteria.params.choiceIds"
                       ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                       aria-label="TransitionCriteriaNode"
                       style="width: 400px;">
              <md-option ng-value="''">
                <span layout="row" layout-align="start center">
                  <span class="node-select__text" style="color: red">{{ ::'pleaseSelectAChoice' | translate }}</span>
                </span>
              </md-option>
              <md-optgroup>
                <md-option ng-value="choice.id" ng-repeat="choice in ::nodeAuthoringController.getChoicesByNodeIdAndComponentId(criteria.params.nodeId, criteria.params.componentId)">
                  <span layout="row" layout-align="start center">
                    <span class="node-select__text">{{::choice.text}}</span>
                  </span>
                </md-option>
              </md-optgroup>
            </md-select>
            <md-select id="checkboxChoiceIdsSelectMenu"
                       ng-if='param.value == "choiceIds" && "checkbox" == nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(criteria.params.nodeId, criteria.params.componentId)'
                       md-theme="default"
                       class="node-select md-subhead"
                       ng-model="criteria.params.choiceIds"
                       ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                       aria-label="TransitionCriteriaNode"
                       style="width: 400px;"
                       multiple={{nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(criteria.params.nodeId, criteria.params.componentId)}}>
              <md-optgroup>
                <md-option ng-value="choice.id" ng-repeat="choice in nodeAuthoringController.getChoicesByNodeIdAndComponentId(criteria.params.nodeId, criteria.params.componentId)">{{choice.text}}</md-option>
              </md-optgroup>
            </md-select>
            <div ng-if='param.value == "choiceIds" && "checkbox" == nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(criteria.params.nodeId, criteria.params.componentId) && criteria.params.choiceIds == ""' style='margin-left: 10px;'><span style="color: red">{{ ::'pleaseSelectAChoice' | translate }}</span></div>
            <input ng-if='param.value == "requiredNumberOfWords"'
                   type='number'
                   ng-model='criteria.params.requiredNumberOfWords'
                   ng-model-options='{ debounce: 1000 }'
                   style="width: 400px;"
                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'/>
            <div ng-if='param.value == "requiredNumberOfWords" && (criteria.params.requiredNumberOfWords == null || criteria.params.requiredNumberOfWords == "")'><span style="color: red">{{ ::'pleaseEnterTheRequiredNumberOfWords' | translate }}</span></div>
            <input ng-if='param.value == "requiredNumberOfNotes"'
                   type='number'
                   ng-model='criteria.params.requiredNumberOfNotes'
                   ng-model-options='{ debounce: 1000 }'
                   style="width: 400px;"
                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'/>
            <div ng-if='param.value == "requiredNumberOfNotes" && (criteria.params.requiredNumberOfNotes == null || criteria.params.requiredNumberOfNotes == "")'><span style="color: red">{{ 'pleaseEnterTheRequiredNumberOfNotes' | translate }}</span></div>
            <input ng-if='param.value == "requiredNumberOfFilledRows"'
                   type='number'
                   ng-model="criteria.params.requiredNumberOfFilledRows"
                   ng-model-options='{ debounce: 1000 }'
                   style="width: 450px;"
                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'/>
            <div ng-if='param.value == "requiredNumberOfFilledRows" && (criteria.params.requiredNumberOfFilledRows == null || criteria.params.requiredNumberOfFilledRows == "")'><span style="color: red">{{ 'pleaseEnterTheRequiredNumberOfFilledRows' | translate }}</span></div>
            <md-checkbox ng-if="param.value == 'tableHasHeaderRow'"
                         ng-model="criteria.params.tableHasHeaderRow"
                         style="width: 400px;"
                         ng-change='nodeAuthoringController.authoringViewNodeChanged()'>
              {{ ::param.text }}
            </md-checkbox>
            <md-checkbox ng-if="param.value == 'requireAllCellsInARowToBeFilled'"
                         ng-model="criteria.params.requireAllCellsInARowToBeFilled"
                         style="width: 400px;"
                         ng-change='nodeAuthoringController.authoringViewNodeChanged()'>
              {{ ::param.text }}
            </md-checkbox>
          </md-input-container>
        </div>
        <div style="margin-left: 50px;">
          <label class='node__label--vertical-alignment'>{{ ::'addRemovalCriteria' | translate }}</label>
          <md-button class='topButton md-raised md-primary'
                     ng-click='nodeAuthoringController.addRemovalCriteria(constraint)'>
            <md-icon>add</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'addRemovalCriteria' | translate }}</md-tooltip>
          </md-button>
        </div>
      </div>
      <div ng-if="nodeAuthoringController.node.constraints.length > 0">
        <label class='node__label--vertical-alignment'>{{ ::'addConstraint' | translate }}</label>
        <md-button class='topButton md-raised md-primary'
                   ng-click='nodeAuthoringController.addConstraintAndScrollToBottom()'>
          <md-icon>add</md-icon>
          <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ '::addConstraint' | translate }}</md-tooltip>
        </md-button>
      </div>
    </div>
    <div ng-if='nodeAuthoringController.showCreateBranch'
       class='bodyDiv'>
      {{ ::'createBranch' | translate }}
      <br/>

      <div>
        {{ ::'numberOfBranchPaths' | translate }}
        <input type='number'
             ng-model='nodeAuthoringController.createBranchNumberOfBranches'
             ng-change='nodeAuthoringController.createBranchNumberOfBranchesChanged()'/>
        <button ng-click='nodeAuthoringController.removeBranchButtonClicked()' translate='removeBranch'></button>
      </div>

      <div ng-if='nodeAuthoringController.createBranchNumberOfBranches > 1'>
        <div>
          {{ ::'howToChooseAmongPaths' | translate }}
          <md-select md-theme="default"
                 class="node-select md-subhead"
                 style="margin-left:30px; width:600px"
                 ng-model="nodeAuthoringController.createBranchCriterion"
                 ng-change="nodeAuthoringController.createBranchCriterionChanged()">
            <md-option ng-repeat="branchCriterion in nodeAuthoringController.branchCriteria"
                   value="{{ branchCriterion.value }}">
              <span layout="row" layout-align="start center">
                <span class="node-select__text">{{::branchCriterion.text}}</span>
              </span>
            </md-option>
          </md-select>
        </div>

        <div ng-if='nodeAuthoringController.createBranchCriterion == "score" || nodeAuthoringController.createBranchCriterion == "choiceChosen"'>
          {{ ::'chooseStep' | translate }}
          <md-select md-theme="default"
                 class="node-select md-subhead"
                 ng-model="nodeAuthoringController.createBranchNodeId"
                 ng-change="nodeAuthoringController.createBranchNodeIdChanged()"
                 style="margin-left:30px; width:600px">
            <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                   value="{{ item.$key }}"
                   ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
              <span layout="row" layout-align="start center">
                <span class="node-select__text">{{ ::projectController.getNodePositionById(item.$key) + ': '}}{{ ::projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
              </span>
            </md-option>
          </md-select>
        </div>

        <div ng-if='nodeAuthoringController.createBranchCriterion == "score" || nodeAuthoringController.createBranchCriterion == "choiceChosen"'>
          {{ ::'chooseComponent' | translate }}
          <md-select md-theme="default"
                 class="node-select md-subhead"
                 ng-model="nodeAuthoringController.createBranchComponentId"
                 ng-change="nodeAuthoringController.createBranchComponentIdChanged()"
                 style="margin-left:30px; width:600px">
            <md-option ng-repeat="component in ::projectController.getComponentsByNodeId(nodeAuthoringController.createBranchNodeId)"
                   value="{{ ::component.id }}">
              <span layout="row" layout-align="start center">
                <span class="node-select__text">ID: {{::component.id}} | Type: {{::component.type}} | Prompt: {{::component.prompt}}</span>
              </span>
            </md-option>
          </md-select>
        </div>

        <div ng-repeat='branch in nodeAuthoringController.createBranchBranches'
           style='border: 1px solid black'>
          {{ ::'branchPath' | translate }} {{::branch.number}}

          <div ng-if='nodeAuthoringController.createBranchCriterion == "workgroupId"'>
            {{ ::'WORKGROUP_ID' | translate }}
          </div>

          <div ng-if='nodeAuthoringController.createBranchCriterion == "score"'>
            {{ ::'SCORE' | translate }}
            <input type='text'
                 ng-model='branch.scores'
                 ng-change='nodeAuthoringController.createBranchScoreChanged(branch)'
                 ng-list=','/>
          </div>

          <div ng-if='nodeAuthoringController.createBranchCriterion == "choiceChosen"'>
            {{ ::'choiceChosen' | translate }}
            <md-select ng-model='branch.choiceId'>
              <md-option ng-repeat='choice in branch.choices'
                     value='{{ choice.id }}'>
                 <span layout="row" layout-align="start center">
                   <span class="node-select__text">{{ ::'ID' | translate }}: {{choice.id}} | {{ ::'TEXT' | translate }}: {{choice.text}} | {{ ::'IS_CORRECT' | translate }}: {{choice.isCorrect}} | {{ ::'FEEDBACK' | translate }}: {{choice.feedback}}</span>
                 </span>
              </md-option>
            </md-select>
          </div>

          <div ng-if='nodeAuthoringController.createBranchCriterion == "random"'>
            {{ ::'random' | translate }}
          </div>

          <button ng-click='branch.openStepsChooser = !branch.openStepsChooser'>{{ branch.openStepsChooser ? ('closeBranchPathXStepsChooser' | translate:'{ branchNumber: ' + branch.number + ' }') : 'openBranchPathXStepsChooser' | translate:'{ branchNumber: ' + branch.number + ' }' }}</button>
          <div ng-if='branch.openStepsChooser'>
            {{ ::'chooseStepsInPath' | translate }}
            <br/>
            <div ng-repeat='item in branch.items | toArray | orderBy : "order"'
               ng-class='{"node-select--group": projectController.isGroupNode(item.$key), "node-select--node": !projectController.isGroupNode(item.$key)}'
               ng-if='!projectController.importMode'>
              <input type='checkbox'
                   ng-model='item.checked'
                   ng-if='item.order!==0 && !(projectController.showCreateGroup || projectController.showCreateNode || projectController.insertNodeMode || projectController.insertGroupMode)'
                   ng-click='nodeAuthoringController.createBranchStepClicked(branch, item)' />
              <h6 ng-click='item.checked = !item.checked; nodeAuthoringController.createBranchStepClicked(branch, item)'
                style='display:inline; cursor:pointer'
                ng-class='{"groupHeader": projectController.isGroupNode(item.$key), "stepHeader": !projectController.isGroupNode(item.$key)}'
                ng-if='item.order!==0'>
                {{::projectController.getNodePositionById(item.$key)}} {{::projectController.getNodeTitleByNodeId(item.$key)}}
              </h6>
            </div>
            <button ng-click='branch.openStepsChooser = !branch.openStepsChooser'>{{ branch.openStepsChooser ? ('closeBranchPathXStepsChooser' | translate:'{ branchNumber: ' + branch.number + ' }') : 'openBranchPathXStepsChooser' | translate:'{ branchNumber: ' + branch.number + ' }' }}</button>
          </div>
        </div>
        <div>
          {{ ::'chooseMergePoint' | translate }}
          <md-select md-theme="default"
                 class="node-select md-subhead"
                 ng-model="nodeAuthoringController.createBranchMergePointNodeId"
                 ng-change="nodeAuthoringController.createBranchMergePointNodeIdChanged()"
                 style="margin-left:30px; width:600px">
            <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                   value="{{ item.$key }}"
                   ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
              <span layout="row" layout-align="start center">
                <span class="node-select__text">{{ ::projectController.getNodePositionById(item.$key) + ': '}}{{ ::projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
              </span>
            </md-option>
          </md-select>
        </div>
      </div>
    </div>
    <div ng-if='nodeAuthoringController.showJSON'
       class='bodyDiv'>
      <h6 ng-if='projectController.isGroupNode(nodeAuthoringController.nodeId)'>{{ ::'editActivityJSON' | translate }}</h6>
      <h6 ng-if='!projectController.isGroupNode(nodeAuthoringController.nodeId)'>{{ ::'editStepJSON' | translate }}</h6>
      <md-input-container style='width: 100%;'>
        <textarea ng-model='nodeAuthoringController.authoringNodeContentJSONString'
            ng-change='nodeAuthoringController.autoSaveJSON()'
            ng-model-options='{ debounce: 1000 }'
            style='width: 90%; border: 1px solid black;'></textarea>
      </md-input-container>
    </div>
  </div>

  <div ng-if='nodeAuthoringController.showRubric'>
    <summernote id='{{nodeAuthoringController.summernoteRubricId}}'
          ng-model='nodeAuthoringController.summernoteRubricHTML'
          ng-change='nodeAuthoringController.summernoteRubricHTMLChanged()'
          config='nodeAuthoringController.summernoteRubricOptions'
          ng-model-options='{ debounce: 1000 }'
          rows='10'
          cols='100'>
    </summernote>
  </div>

  <div ng-if='nodeAuthoringController.insertComponentMode' layout='row' style='margin-left: 10px; height:50px'>
    <div layout='row'>
      <h6 translate="chooseNewLocation"></h6>
    </div>
    <div layout='row'>
      <md-button class='createButton md-raised md-primary'
             ng-click='nodeAuthoringController.cancelInsertClicked()'
             aria-label="{{ ::'CANCEL' | translate }}"
             translate="CANCEL"></md-button>
    </div>
  </div>
</div>

<div ng-if='nodeAuthoringController.showImportView'>
  <h4>{{ ::'importComponentsParens' | translate }}</h4>
  <br/>
  <span>{{ ::'chooseAProjectToImportAndThenChooseAComponent' | translate }}</span>
  <br/>
  <md-input-container style='margin-right: 20px; width: 100%;'>
    <label>{{ ::'myProjects' | translate }}</label>
    <md-select ng-model='nodeAuthoringController.importMyProjectId'
           ng-change='nodeAuthoringController.showMyImportProject(nodeAuthoringController.importMyProjectId)'
           style='width: 100%;'>
      <md-option ng-repeat="project in nodeAuthoringController.myProjectsList"
             value='{{project.id}}'>
        {{project.id + ' ' + project.name + (project.runId ? ' (' + ('RUN_ID' | translate) + ': ' + project.runId + ')': '')}}
      </md-option>
    </md-select>
  </md-input-container>
  <br/>
  <md-input-container style='margin-right: 20px; width: 100%;'>
    <label>{{ ::'libraryProjects' | translate }}</label>
    <md-select ng-model='nodeAuthoringController.importLibraryProjectId'
           ng-change='nodeAuthoringController.showLibraryImportProject(nodeAuthoringController.importLibraryProjectId)'
           style='width: 100%;'>
      <md-option ng-repeat="project in nodeAuthoringController.libraryProjectsList"
             value='{{project.id}}'>
        {{project.id + ' ' + project.title + (project.runId ? ' (' + ('RUN_ID' | translate) + ': ' + project.runId + ')': '')}}
      </md-option>
    </md-select>
  </md-input-container>
  <br/>
  <span ng-if="nodeAuthoringController.importProject != null">
    <div style='background-color: white; position: sticky; top: 65px; z-index: 3;'>
      <span>{{ ::'afterYouHaveChosenTheComponentToImportClickThisButtonToImport' | translate }}</span>
      <md-button class='topButton md-raised md-primary'
          ng-click='nodeAuthoringController.importComponentsButtonClicked()'>
        <md-icon>vertical_align_bottom</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'importComponentsParens' | translate }}</md-tooltip>
      </md-button>
    </div>
    <br/>
    <h4 style='display:inline'>{{nodeAuthoringController.importProject.metadata.title}}</h4>
    <md-button class='topButton md-raised md-primary'
        ng-click='nodeAuthoringController.previewImportProject()'>
      <md-icon>visibility</md-icon>
      <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'previewProject' | translate }}</md-tooltip>
    </md-button>
    <br/>
    <div ng-repeat='importItem in nodeAuthoringController.importProjectIdToOrder'
      ng-class='{"groupHeader": importItem.node.type == "group", "stepHeader": importItem.node.type != "group"}'>
      <h6 style='display: inline; cursor: pointer'
        ng-if='importItem.order != 0'>
        {{::importItem.stepNumber}}: {{::importItem.node.title}}
      </h6>
      <md-button class='topButton md-raised md-primary'
          ng-if='importItem.node.type != "group"'
          ng-click='nodeAuthoringController.previewImportNode(importItem.node)'
          aria-label='{{ ::"previewStep" | translate }}'>
        <md-icon>visibility</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'previewStep' | translate }}</md-tooltip>
      </md-button>
      <div ng-repeat='component in importItem.node.components track by $index'
        class='componentHeader'>
        <div layout='row'>
          <div layout='row'>
            <md-checkbox ng-model='component.checked'>
              <span>{{::($index + 1)}}. {{::component.type}}</span>
            </md-checkbox>
          </div>
          <div layout='row' style='height: 40px;'>
            <md-button class='regularButton md-raised md-primary'
                style='margin-top: -5px;'
                ng-if='importItem.node.type != "group"'
                ng-click='nodeAuthoringController.previewImportComponent(importItem.node, component.id)'
                aria-label='{{ ::"previewComponent" | translate }}'>
              <md-icon>visibility</md-icon>
              <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'previewComponent' | translate }}</md-tooltip>
            </md-button>
          </div>
        </div>
      </div>
    </div>
    <md-button class='topButton md-raised md-primary'
        ng-click='nodeAuthoringController.importComponentsButtonClicked()'>
      <md-icon>vertical_align_bottom</md-icon>
      <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'importComponentsParens' | translate }}</md-tooltip>
    </md-button>
  </span>
</div>
<!-- input for changing the step title -->
<div ng-if='nodeAuthoringController.showComponents && !nodeAuthoringController.insertComponentMode && !nodeAuthoringController.importComponentMode'>
  <div layout='row' style='margin-left: 10px; max-height: 60px;'>
    <div layout='row' style='margin-top: 18px; margin-right: 10px;'>
      <h6 ng-if="!projectController.isGroupNode(nodeAuthoringController.node.id)">{{ ::'stepTitle' | translate }} {{ nodeAuthoringController.nodePosition }}:</h6>
      <h6 ng-if="projectController.isGroupNode(nodeAuthoringController.node.id)">{{ ::'activityTitle' | translate }} {{ nodeAuthoringController.nodePosition }}:</h6>
    </div>
    <div layout='row'>
      <md-input-container style="width:500px">
        <input ng-model='nodeAuthoringController.node.title'
             ng-change='nodeAuthoringController.authoringViewNodeChanged()'
             ng-model-options='{ debounce: 500 }'
             aria-label='{{ ::"title" | translate }}'
             size='60'/>
      </md-input-container>
    </div>
  </div>
</div>
<div style='margin-left: 45px;' ng-if='nodeAuthoringController.insertComponentMode'>
  <md-button class='moveComponentButton md-raised md-primary'
         ng-click='nodeAuthoringController.insertComponentAsFirst()'>
    <md-icon>keyboard_backspace</md-icon>
    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'insertAsFirstComponent' | translate }}</md-tooltip>
  </md-button>
  <span style='font-weight:bold; margin-right:10px'>{{ ::'insertAsFirstComponent' | translate }}</span>
</div>
<div style='margin-left: 45px; margin-top: 45px; font-size: 1em; font-weight: bold;' ng-if='nodeAuthoringController.showComponents && !nodeAuthoringController.showImportView &&
   nodeAuthoringController.components.length === 0 && !nodeAuthoringController.insertComponentMode && nodeAuthoringController.node.type != "group"''>
   <em>{{ ::'stepHasNoComponents' | translate }}</em>
</div>
<div ng-repeat='(componentIndex, component) in nodeAuthoringController.components'
   class='component md-padding'
   style='padding: 0; margin-top: 0; margin-left: 16px;'
   ng-if='nodeAuthoringController.showComponents && !nodeAuthoringController.showImportView'>
  <div id='{{component.id}}' layout='row' style='height: 40px; margin-top: 0; margin-bottom: 0;'>
    <div style='margin-top: 15px; width: 200px;'>
      <md-checkbox ng-model='nodeAuthoringController.componentsToChecked[component.id]'
             ng-disabled='nodeAuthoringController.insertComponentMode'>
        <span style='font-weight:bold; margin-right:10px'>{{::(componentIndex + 1)}}. {{::nodeAuthoringController.getComponentTypeLabel(component.type)}}</span>
      </md-checkbox>
    </div>
    <div ng-if='!nodeAuthoringController.insertComponentMode && nodeAuthoringController.showComponentAuthoringViews'>
      <md-input-container style='margin-top: 0; margin-right: 20px; width: 150px;'>
        <md-button class='topButton md-raised md-primary' ng-click='nodeAuthoringController.componentAdvancedButtonClicked(component.id)'>
          <md-icon>build</md-icon>
          <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::'ADVANCED' | translate }}</md-tooltip>
        </md-button>
      </md-input-container>
    </div>
  </div>
  <div style='height: 30px; margin-top: 10px; margin-left: 30px;' ng-if='nodeAuthoringController.insertComponentMode'>
    <md-button class='moveComponentButton md-raised md-primary'
           style='margin-top: 0;'
           ng-click='nodeAuthoringController.insertComponentAfter(component.id)'>
      <md-icon>keyboard_backspace</md-icon>
      <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ ::"insertAfter" | translate }}</md-tooltip>
    </md-button>
  </div>
  <component ng-if='nodeAuthoringController.showComponentAuthoringViews' node-id='{{nodeAuthoringController.nodeId}}' component-id='{{component.id}}' mode='authoring'></component>
  <md-divider ng-if='nodeAuthoringController.showComponentAuthoringViews && !$last'></md-divider>
</div>
