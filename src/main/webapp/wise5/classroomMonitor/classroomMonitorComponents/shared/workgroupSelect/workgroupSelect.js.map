{"version":3,"sources":["workgroupSelect.es6"],"names":["WorkgroupSelectController","$filter","$scope","orderBy","ConfigService","TeacherDataService","$translate","$onInit","placeholder","customPlaceholder","canViewStudentNames","getPermissions","periodId","getCurrentPeriod","setWorkgroups","$on","event","args","workgroup","currentWorkgroup","currentPeriod","workgroups","angular","copy","getClassmateUserInfos","byStudent","students","sortByStudentId","ids","userIds","names","displayNames","split","x","length","id","current","userId","name","trim","indexOfSpace","indexOf","firstName","substring","lastName","push","workgroupId","selectedItem","getCurrentWorkgroup","setCurrentWorkgroup","localGroup","query","items","search","RegExp","searchTerm","$inject","WorkgroupSelect","bindings","customClass","useAutocomplete","template","controller"],"mappings":"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","file":"workgroupSelect.js","sourcesContent":["\"use strict\";\n\nclass WorkgroupSelectController {\n    constructor($filter,\n                $scope,\n                orderBy,\n                ConfigService,\n                TeacherDataService) {\n        this.$filter = $filter;\n        this.$scope = $scope;\n        this.orderBy = orderBy;\n        this.ConfigService = ConfigService;\n        this.TeacherDataService = TeacherDataService;\n        this.$translate = this.$filter('translate');\n\n        this.$onInit = () => {\n            this.placeholder = this.customPlaceholder ? this.customPlaceholder : this.$translate('findAStudent');\n            this.canViewStudentNames = this.ConfigService.getPermissions().canViewStudentNames;\n            this.periodId = this.TeacherDataService.getCurrentPeriod().periodId;\n            this.setWorkgroups();\n        };\n\n        /**\n         * Listen for current workgroup changed event\n         */\n        this.$scope.$on('currentWorkgroupChanged', (event, args) => {\n            let workgroup = args.currentWorkgroup;\n            if (workgroup != null) {\n                this.setWorkgroups();\n            }\n        });\n\n        /**\n         * Listen for current period changed event\n         */\n        this.$scope.$on('currentPeriodChanged', (event, args) => {\n            this.periodId = args.currentPeriod.periodId;\n            this.setWorkgroups();\n        });\n    };\n\n    /**\n     * Setup the workgroups data model based on whether we're showing\n     * individual students and whether current user can view student names\n     */\n    setWorkgroups() {\n        this.workgroups = angular.copy(this.ConfigService.getClassmateUserInfos());\n        if (this.byStudent) {\n            let students = [];\n            let sortByStudentId = false;\n            for (let workgroup of this.workgroups) {\n                if (this.periodId === -1 || this.periodId === workgroup.periodId) {\n                    let ids = workgroup.userIds;\n                    let names = workgroup.displayNames.split(',');\n                    for (let x = 0; x < ids.length; x++) {\n                        // get the id and name for the current student\n                        let id = ids[x];\n                        let current = angular.copy(workgroup);\n                        current.userId = id;\n                        if (this.canViewStudentNames) {\n                            let name = names[x].trim();\n                            // get the index of the first empty space\n                            let indexOfSpace = name.indexOf(' ');\n\n                            // get the student first name e.g. \"Spongebob\"\n                            let firstName = name.substring(0, indexOfSpace);\n                            let lastName = name.substring(indexOfSpace+1);\n                            current.displayNames = lastName + ', ' + firstName;\n                        } else {\n                            let sortByStudentId = true;\n                            current.displayNames = this.$translate('studentId', { id: id });\n                        }\n                        students.push(current);\n                    }\n                }\n            }\n            this.workgroups = sortByStudentId ? this.orderBy(students, 'userId') : this.orderBy(students, 'displayNames');\n        } else {\n            let workgroups = [];\n            for (let workgroup of this.workgroups) {\n                if (this.periodId === -1 || this.periodId === workgroup.periodId) {\n                    workgroup.displayNames += ' (' + this.$translate('teamId', { id: workgroup.workgroupId}) + ')';\n                    workgroups.push(workgroup);\n                }\n            }\n            this.workgroups = this.orderBy(workgroups, 'workgroupId');\n        }\n        this.selectedItem = this.getCurrentWorkgroup();\n    }\n\n    /**\n     * Set the currently selected workgroup\n     * @param workgroup the workgroup object\n     */\n    setCurrentWorkgroup(workgroup) {\n        this.TeacherDataService.setCurrentWorkgroup(workgroup);\n    }\n\n    /**\n     * Get the current workgroup\n     * @return workgroup object\n     */\n    getCurrentWorkgroup() {\n        let localGroup = null;\n        let currentWorkgroup = this.TeacherDataService.getCurrentWorkgroup();\n        if (currentWorkgroup) {\n            for (let workgroup of this.workgroups) {\n                if (currentWorkgroup.workgroupId === workgroup.workgroupId) {\n                    if (this.byStudent) {\n                        if (currentWorkgroup.userId === workgroup.userId) {\n                            localGroup = workgroup;\n                            break;\n                        }\n                    } else {\n                        localGroup = workgroup;\n                        break;\n                    }\n                }\n            }\n        }\n        return localGroup;\n    }\n\n    /**\n     * Return workgroups with username text that query string matches\n     * @param query String to search for\n     * @return Array of workgroups\n     */\n    querySearch(query) {\n        let items = [];\n        for (let workgroup of this.workgroups) {\n            let periodId = workgroup.periodId;\n            if (this.periodId === -1 || periodId === this.periodId) {\n                let displayNames = workgroup.displayNames;\n                if (displayNames.search(new RegExp(query, 'i')) > -1 || !query) {\n                    items.push(workgroup);\n                }\n            }\n        }\n        return items;\n    }\n\n    selectedItemChange() {\n        let currentWorkgroup = this.getCurrentWorkgroup();\n        if (currentWorkgroup) {\n            if (this.selectedItem) {\n                if (this.byStudent) {\n                    if (currentWorkgroup.userId !== this.selectedItem.userId) {\n                        this.setCurrentWorkgroup(this.selectedItem);\n                    }\n                } else if (currentWorkgroup.workgroupId !== this.selectedItem.workgroupId) {\n                    this.setCurrentWorkgroup(this.selectedItem);\n                }\n            } else {\n                this.setCurrentWorkgroup(null);\n            }\n        } else {\n            this.setCurrentWorkgroup(this.selectedItem);\n        }\n    }\n\n    clearSearchTerm() {\n        this.searchTerm = '';\n    }\n}\n\nWorkgroupSelectController.$inject = [\n    '$filter',\n    '$scope',\n    'orderByFilter',\n    'ConfigService',\n    'TeacherDataService'\n];\n\nconst WorkgroupSelect = {\n    bindings: {\n        byStudent: '<',\n        customClass: '<',\n        customPlaceholder: '<',\n        useAutocomplete: '<'\n    },\n    template:\n        `<md-autocomplete ng-if=\"$ctrl.useAutocomplete\"\n                          class=\"autocomplete\"\n                          ng-class=\"$ctrl.customClass\"\n                          md-no-cache=\"true\"\n                          md-selected-item=\"$ctrl.selectedItem\"\n                          md-search-text=\"$ctrl.searchText\"\n                          md-selected-item-change=\"$ctrl.selectedItemChange()\"\n                          md-items=\"workgroup in $ctrl.querySearch($ctrl.searchText)\"\n                          md-item-text=\"workgroup.displayNames\"\n                          md-min-length=\"0\"\n                          ng-init=\"$ctrl.searchText=$ctrl.selectedItem.displayNames\"\n                          placeholder=\"{{ $ctrl.placeholder }}\"\n                          title=\"{{ $ctrl.placeholder }}\">\n            <md-item-template>\n                <span md-highlight-text=\"$ctrl.searchText\"\n                      md-highlight-flags=\"ig\">{{ workgroup.displayNames }}</span>\n            </md-item-template>\n            <md-not-found>\n                {{ 'noMatchesFound' | translate }}\n            </md-not-found>\n        </md-autocomplete>\n        <md-select ng-if=\"!$ctrl.useAutocomplete\"\n                   md-theme=\"default\"\n                   ng-class=\"$ctrl.customClass\"\n                   md-container-class=\"stepSelectMenuContainer\"\n                   aria-label=\"{{ $ctrl.placeholder }}\"\n                   ng-model=\"$ctrl.selectedItem\"\n                   ng-change=\"$ctrl.selectedItemChange()\"\n                   md-on-close=\"$ctrl.clearSearchTerm()\"\n                   md-selected-text=\"$ctrl.selectedItem.displayNames\">\n            <md-select-header class=\"select__header\" layout=\"row\" flex>\n                <input ng-model=\"$ctrl.searchTerm\"\n                       type=\"search\"\n                       placeholder=\"{{ 'findAStudent' | translate }}\"\n                       ng-keydown=\"$event.stopPropagation()\">\n            </md-select-header>\n            <md-divider></md-divider>\n            <md-opt-group>\n                <md-option ng-repeat=\"workgroup in $ctrl.workgroups |\n                    filter:$ctrl.searchTerm\"\n                    ng-value=\"workgroup\">\n                    <!-- TODO: add avatar? -->\n                    <span class=\"node-select__text\">{{ workgroup.displayNames }}</span>\n                </md-option>\n            </md-opt-group>\n        </md-select>`,\n    controller: WorkgroupSelectController\n};\n\nexport default WorkgroupSelect;\n"]}