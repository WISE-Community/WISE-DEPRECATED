{"version":3,"sources":["labelService.es6"],"names":["LabelService","$filter","$q","StudentAssetService","StudentDataService","UtilService","$translate","component","id","generateKey","type","prompt","showSaveButton","showSubmitButton","backgroundImage","canCreateLabels","canEditLabels","canDeleteLabels","enableCircles","width","height","pointSize","fontSize","labelWidth","labels","componentToCopy","createComponent","length","l","label","push","componentStateFromOtherComponent","componentState","createComponentState","otherComponentType","componentType","studentData","studentDataCopy","makeCopyOfJSONObject","componentStates","componentEvents","nodeEvents","node","result","canEdit","hasNodeEnteredEvent","submitRequired","i","state","isSubmit","hasShowWorkConnectedComponent","componentContent","starterLabels","labelArraysAreTheSame","labels1","labels2","label1","label2","labelsAreTheSame","text","pointX","pointY","textX","textY","color","maxCharactersPerLine","xPositionOfText","spaceInbetweenLines","textWrapped","wordWrap","deferred","defer","svgElement","document","createElement","draw","SVG","tspans","textLines","split","textLine","svgTextElementString","svgString","innerHTML","replace","myCanvas","ctx","getContext","svg","Blob","domURL","self","URL","webkitURL","url","createObjectURL","image","Image","thisUtilService","onload","event","target","drawImage","base64Image","toDataURL","imageObject","getImageObjectFromBase64String","uploadAsset","then","unreferencedAsset","copyAssetForReference","referencedAsset","referencedAssetUrl","deleteAsset","resolve","src","promise","$inject"],"mappings":"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","file":"labelService.js","sourcesContent":["import NodeService from '../../services/nodeService';\n\nclass LabelService extends NodeService {\n\n  constructor($filter,\n      $q,\n      StudentAssetService,\n      StudentDataService,\n      UtilService) {\n    super();\n    this.$filter = $filter;\n    this.$q = $q;\n    this.StudentAssetService = StudentAssetService;\n    this.StudentDataService = StudentDataService;\n    this.UtilService = UtilService;\n    this.$translate = this.$filter('translate');\n  }\n\n  /**\n   * Get the component type label\n   * example\n   * \"Label\"\n   */\n  getComponentTypeLabel() {\n    return this.$translate('label.componentTypeLabel');\n  }\n\n  /**\n   * Create a Label component object\n   * @returns a new Label component object\n   */\n  createComponent() {\n    var component = {};\n    component.id = this.UtilService.generateKey();\n    component.type = 'Label';\n    component.prompt = '';\n    component.showSaveButton = false;\n    component.showSubmitButton = false;\n    component.backgroundImage = '';\n    component.canCreateLabels = true;\n    component.canEditLabels = true;\n    component.canDeleteLabels = true;\n    component.enableCircles = true;\n    component.width = 800;\n    component.height = 600;\n    component.pointSize = 5;\n    component.fontSize = 20;\n    component.labelWidth = 20;\n    component.labels = [];\n    return component;\n  }\n\n  /**\n   * Copies an existing Label component object\n   * @returns a copied Label component object\n   */\n  copyComponent(componentToCopy) {\n    var component = this.createComponent();\n    component.prompt = componentToCopy.prompt;\n    component.showSaveButton = componentToCopy.showSaveButton;\n    component.showSubmitButton = componentToCopy.showSubmitButton;\n    component.backgroundImage = componentToCopy.backgroundImage;\n    component.canCreateLabels = componentToCopy.canCreateLabels;\n    component.canEditLabels = componentToCopy.canEditLabels;\n    component.canDeleteLabels = componentToCopy.canDeleteLabels;\n    component.enableCircles = componentToCopy.enableCircles;\n    component.width = componentToCopy.width;\n    component.height = componentToCopy.height;\n    component.pointSize = componentToCopy.pointSize;\n    component.fontSize = componentToCopy.fontSize;\n    component.labelWidth = componentToCopy.labelWidth;\n    component.labels = [];\n    // go through the original labels and create new id's\n    if (componentToCopy.labels != null && componentToCopy.labels.length > 0) {\n      for (var l = 0; l < componentToCopy.labels.length; l++) {\n        var label = componentToCopy.labels[l];\n        label.id = this.UtilService.generateKey();  // generate a new id for this label.\n        component.labels.push(label);\n      }\n    }\n    return component;\n  }\n\n  /**\n   * Populate a component state with the data from another component state\n   * @param componentStateFromOtherComponent the component state to obtain the data from\n   * @return a new component state that contains the student data from the other\n   * component state\n   */\n  populateComponentState(componentStateFromOtherComponent) {\n    var componentState = null;\n\n    if (componentStateFromOtherComponent != null) {\n\n      // create an empty component state\n      componentState = this.StudentDataService.createComponentState();\n\n      // get the component type of the other component state\n      var otherComponentType = componentStateFromOtherComponent.componentType;\n\n      if (otherComponentType === 'Label') {\n        // the other component is an Label component\n\n        // get the student data from the other component state\n        var studentData = componentStateFromOtherComponent.studentData;\n\n        // create a copy of the student data\n        var studentDataCopy = this.UtilService.makeCopyOfJSONObject(studentData);\n\n        // set the student data into the new component state\n        componentState.studentData = studentDataCopy;\n      }\n    }\n\n    return componentState;\n  };\n\n  /**\n   * Check if the component was completed\n   * @param component the component object\n   * @param componentStates the component states for the specific component\n   * @param componentEvents the events for the specific component\n   * @param nodeEvents the events for the parent node of the component\n   * @param node parent node of the component\n   * @returns whether the component was completed\n   */\n  isCompleted(component, componentStates, componentEvents, nodeEvents, node) {\n    var result = false;\n    if (!this.canEdit(component) && this.UtilService.hasNodeEnteredEvent(nodeEvents)) {\n      /*\n       * the student can't perform any work on this component and has visited\n       * this step so we will mark it as completed\n       */\n      return true;\n    }\n    if (componentStates && componentStates.length) {\n      let submitRequired = node.showSubmitButton || (component.showSubmitButton && !node.showSaveButton);\n\n      if (submitRequired) {\n        // completion requires a submission, so check for isSubmit in any component states\n        for (let i = 0, l = componentStates.length; i < l; i++) {\n          let state = componentStates[i];\n          if (state.isSubmit && state.studentData) {\n            // component state is a submission\n            if (state.studentData.labels && state.studentData.labels.length) {\n              // there are labels so the component is completed\n              result = true;\n              break;\n            }\n          }\n        }\n      } else {\n        // get the last component state\n        let l = componentStates.length - 1;\n        let componentState = componentStates[l];\n\n        let studentData = componentState.studentData;\n\n        if (studentData != null) {\n          if (studentData.labels && studentData.labels.length) {\n            // there are labels so the component is completed\n            result = true;\n          }\n        }\n      }\n    }\n\n    return result;\n  };\n\n  /**\n   * Determine if the student can perform any work on this component.\n   * @param component The component content.\n   * @return Whether the student can perform any work on this component.\n   */\n  canEdit(component) {\n    if (this.UtilService.hasShowWorkConnectedComponent(component)) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Whether this component generates student work\n   * @param component (optional) the component object. if the component object\n   * is not provided, we will use the default value of whether the\n   * component type usually has work.\n   * @return whether this component generates student work\n   */\n  componentHasWork(component) {\n    return true;\n  }\n\n  /**\n   * Whether this component uses a save button\n   * @return whether this component uses a save button\n   */\n  componentUsesSaveButton() {\n    return true;\n  }\n\n  /**\n   * Whether this component uses a submit button\n   * @return whether this component uses a submit button\n   */\n  componentUsesSubmitButton() {\n    return true;\n  }\n\n  /**\n   * Check if the component state has student work. Sometimes a component\n   * state may be created if the student visits a component but doesn't\n   * actually perform any work. This is where we will check if the student\n   * actually performed any work.\n   * @param componentState the component state object\n   * @param componentContent the component content\n   * @return whether the component state has any work\n   */\n  componentStateHasStudentWork(componentState, componentContent) {\n    if (componentState != null) {\n      let studentData = componentState.studentData;\n      if (studentData != null) {\n        // get the labels from the student data\n        let labels = studentData.labels;\n\n        if (componentContent == null) {\n          // the component content was not provided\n          if (labels != null && labels.length > 0) {\n            // the student has work\n            return true;\n          }\n        } else {\n          // the component content was provided\n          let starterLabels = componentContent.labels;\n          if (starterLabels == null || starterLabels.length == 0) {\n            // there are no starter labels\n            if (labels != null && labels.length > 0) {\n              // the student has work\n              return true;\n            }\n          } else {\n            /*\n             * there are starter labels so we will compare it\n             * with the student labels\n             */\n            if (!this.labelArraysAreTheSame(labels, starterLabels)) {\n              /*\n               * the student has a response that is different than\n               * the starter sentence\n               */\n              return true;\n            }\n          }\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Check if the component state has the exact same labels as the starter\n   * labels.\n   * @param componentState the component state object\n   * @param componentContent the component content\n   * @return whether the component state has the exact same labels as the\n   * starter labels\n   */\n  componentStateIsSameAsStarter(componentState, componentContent) {\n    if (componentState != null) {\n      let studentData = componentState.studentData;\n\n      // get the labels from the student data\n      let labels = studentData.labels;\n      let starterLabels = componentContent.labels;\n      if (starterLabels == null || starterLabels.length == 0) {\n        // there are no starter labels\n        if (labels.length == 0) {\n          // the student work doesn't have any labels either\n          return true;\n        } else if (labels != null && labels.length > 0) {\n          // the student has labels\n          return false;\n        }\n      } else {\n        // there are starter labels so we will compare it with the student labels\n        if (this.labelArraysAreTheSame(labels, starterLabels)) {\n          // the student labels are the same as the starter labels\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Check if the two arrays of labels contain the same values\n   * @param labels1 an array of label objects\n   * @param labels2 an array of label objects\n   * @return whether the labels contain the same values\n   */\n  labelArraysAreTheSame(labels1, labels2) {\n    if (labels1 == null && labels2 == null) {\n      return true;\n    } else if ((labels1 == null && labels2 != null) ||\n           (labels1 != null && labels2 == null)) {\n      return false;\n    } else {\n      if (labels1.length != labels2.length) {\n        return false;\n      } else {\n        for (let l = 0; l < labels1.length; l++) {\n          let label1 = labels1[l];\n          let label2 = labels2[l];\n          if (!this.labelsAreTheSame(label1, label2)) {\n            return false;\n          }\n        }\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Check if two labels contain the same values\n   * @param label1 a label object\n   * @param label2 a label object\n   * @return whether the labels contain the same values\n   */\n  labelsAreTheSame(label1, label2) {\n    if (label1 == null && label2 == null) {\n      return true;\n    } else if ((label1 == null && label2 != null) ||\n        (label1 != null && label2 == null)) {\n      return false;\n    } else {\n      if ((label1.text != label2.text) ||\n        (label1.pointX != label2.pointX) ||\n        (label1.pointY != label2.pointY) ||\n        (label1.textX != label2.textX) ||\n        (label1.textY != label2.textY) ||\n        (label1.color != label2.color)) {\n        // at least one of the fields are different\n        return false\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Create an image from the text string.\n   * @param text A text string.\n   * @param width The width of the image we will create.\n   * @param height The height of the image we will create.\n   * @param maxCharactersPerLine The max number of characters per line.\n   * @param xPositionOfText The x position of the text in the image.\n   * @param spaceInbetweenLines The amount of space inbetween each line.\n   * @param fontSize The font size.\n   */\n  createImageFromText(text, width, height, maxCharactersPerLine,\n      xPositionOfText, spaceInbetweenLines, fontSize) {\n\n    if (width == null || width == '') {\n      width = 800;\n    }\n\n    if (height == null || height == '') {\n      height = 600;\n    }\n\n    if (maxCharactersPerLine == null || maxCharactersPerLine == '') {\n      maxCharactersPerLine = 100;\n    }\n\n    if (xPositionOfText == null || xPositionOfText == '') {\n      xPositionOfText = 10;\n    }\n\n    if (spaceInbetweenLines == null || spaceInbetweenLines == '') {\n      spaceInbetweenLines = 40;\n    }\n\n    if (fontSize == null || fontSize == '') {\n      fontSize = 16;\n    }\n\n    /*\n     * Line wrap the text so that each line does not exceed the max number of\n     * characters.\n     */\n    let textWrapped = this.UtilService.wordWrap(text, maxCharactersPerLine);\n\n    // create a promise that will return an image of the concept map\n    var deferred = this.$q.defer();\n\n    // create a div to draw the SVG in\n    var svgElement = document.createElement('div');\n\n    var draw = SVG(svgElement);\n    draw.width(width);\n    draw.height(height);\n\n    /*\n     * We will create a tspan for each line.\n     * Example\n     * <tspan x=\"10\" dy=\"40\">The quick brown fox jumps over the lazy dog. One fish, two fish, red fish, blue fish. Green eggs</tspan>\n     * <tspan x=\"10\" dy=\"40\">and ham.</tspan>\n     */\n    let tspans = '';\n    let textLines = textWrapped.split('\\n');\n    for (let textLine of textLines) {\n      tspans += '<tspan x=\"' + xPositionOfText + '\" dy=\"' + spaceInbetweenLines + '\">' + textLine + '</tspan>';\n    }\n\n    /*\n     * Wrap the tspans in a text element.\n     * Example\n     * <text id=\"SvgjsText1008\" font-family=\"Helvetica, Arial, sans-serif\" font-size=\"16\">\n     *   <tspan x=\"10\" dy=\"40\">The quick brown fox jumps over the lazy dog. One fish, two fish, red fish, blue fish. Green eggs</tspan>\n     *   <tspan x=\"10\" dy=\"40\">and ham.</tspan>\n     * </text>\n     */\n    let svgTextElementString = '<text id=\"SvgjsText1008\" font-family=\"Helvetica, Arial, sans-serif\" font-size=\"' + fontSize + '\">' + tspans + '</text>';\n\n    /*\n     * Insert the text element into the svg.\n     * Example\n     * <svg id=\"SvgjsSvg1010\" width=\"800\" height=\"600\" xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:svgjs=\"http://svgjs.com/svgjs\">\n     *   <defs id=\"SvgjsDefs1011\"></defs>\n     *   <text id=\"SvgjsText1008\" font-family=\"Helvetica, Arial, sans-serif\" font-size=\"16\">\n     *     <tspan x=\"10\" dy=\"40\">The quick brown fox jumps over the lazy dog. One fish, two fish, red fish, blue fish. Green eggs</tspan>\n     *     <tspan x=\"10\" dy=\"40\">and ham.</tspan>\n     *   </text>\n     * </svg>\n     */\n    var svgString = svgElement.innerHTML;\n    svgString = svgString.replace('</svg>', svgTextElementString + '</svg>');\n\n    // create a canvas to draw the image on\n    var myCanvas = document.createElement('canvas');\n    var ctx = myCanvas.getContext('2d');\n\n    // create an svg blob\n    var svg = new Blob([svgString], {type:'image/svg+xml;charset=utf-8'});\n    var domURL = self.URL || self.webkitURL || self;\n    var url = domURL.createObjectURL(svg);\n    var image = new Image;\n\n    /*\n     * set the UtilService in a local variable so we can access it\n     * in the onload callback function\n     */\n    var thisUtilService = this.UtilService;\n\n    // the function that is called after the image is fully loaded\n    image.onload = (event) => {\n\n      // get the image that was loaded\n      var image = event.target;\n\n      // set the dimensions of the canvas\n      myCanvas.width = image.width;\n      myCanvas.height = image.height;\n      ctx.drawImage(image, 0, 0);\n\n      // get the canvas as a Base64 string\n      var base64Image = myCanvas.toDataURL('image/png');\n\n      // get the image object\n      var imageObject = thisUtilService.getImageObjectFromBase64String(base64Image);\n\n      // create a student asset image\n      this.StudentAssetService.uploadAsset(imageObject).then((unreferencedAsset) => {\n\n        /*\n         * make a copy of the unreferenced asset so that we\n         * get a referenced asset\n         */\n        this.StudentAssetService.copyAssetForReference(unreferencedAsset).then((referencedAsset) => {\n          if (referencedAsset != null) {\n            /*\n             * get the asset url\n             * for example\n             * /wise/studentuploads/11261/297478/referenced/picture_1494016652542.png\n             * if we are in preview mode this url will be a base64 string instead\n             */\n            var referencedAssetUrl = referencedAsset.url;\n\n            // remove the unreferenced asset\n            this.StudentAssetService.deleteAsset(unreferencedAsset);\n\n            // resolve the promise with the image url\n            deferred.resolve(referencedAssetUrl);\n          }\n        });\n      });\n    };\n\n    // set the src of the image so that the image gets loaded\n    image.src = url;\n\n    return deferred.promise;\n  }\n}\n\nLabelService.$inject = [\n  '$filter',\n  '$q',\n  'StudentAssetService',\n  'StudentDataService',\n  'UtilService'\n];\n\nexport default LabelService;\n"]}