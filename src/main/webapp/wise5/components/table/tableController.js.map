{"version":3,"sources":["tableController.es6"],"names":["TableController","$anchorScroll","$filter","$location","$mdDialog","$q","$rootScope","$scope","AnnotationService","ConfigService","NodeService","NotebookService","ProjectService","StudentAssetService","StudentDataService","TableService","UtilService","tableData","latestAnnotations","isResetTableButtonVisible","notebookConfig","getNotebookConfig","latestConnectedComponentState","latestConnectedComponentParams","tableId","nodeId","componentId","mode","isPromptVisible","isSaveButtonVisible","componentContent","showSaveButton","isSubmitButtonVisible","showSubmitButton","isDisabled","componentState","hasShowWorkConnectedComponent","handleConnectedComponents","componentStateHasStudentWork","setStudentWork","hasConnectedComponent","setupTable","maxSubmitCount","submitCounter","isSubmitButtonDisabled","disableComponentIfNecessary","handleConnectedComponentStudentDataChanged","connectedComponent","connectedComponentParams","updateOn","componentType","type","makeCopyOfJSONObject","tableController","isDirty","setGraphDataIntoTableData","bind","getComponentState","isSubmit","deferred","defer","getState","action","isSubmitDirty","createComponentState","then","resolve","promise","$on","angular","event","args","getNumber","num","array","Array","isNaN","parseInt","$broadcast","studentWork","$emit","isAutoSave","serverSaveTime","clientSaveTime","convertToClientTimestamp","setSubmittedMessage","lockIfNecessary","setAutoSavedMessage","setSavedMessage","isConnectedComponent","getConnectedComponentParams","performUpdate","isTableEmpty","isTableReset","submit","tableDataCopy","tableDataJSONString","JSON","stringify","tableDataJSON","parse","getCopyOfTableData","studentDataChanged","studentData","processLatestStudentWork","createNewComponentState","createComponentStateAdditionalProcessing","params","trialIndex","seriesIndex","showDataAtMouseX","studentDataVersion","version","series","length","tempSeries","setSeriesIntoTable","trials","trial","multipleSeries","mouseOverPoints","x","latestMouseOverPoint","Math","round","xUnits","xAxis","units","yUnits","yAxis","xAxisTitle","title","text","yAxisTitle","removeAllCellsFromTableData","addTableDataRow","createTableRow","show","singleSeries","closestDataPoint","getClosestDataPoint","data","name","getXFromDataPoint","getYFromDataPoint","row","push","editable","size","columns","column","constructor","createTableCell","dataPoints","minNumericalXDifference","Infinity","dataPoint","dataPointX","numericalDifference","getNumericalAbsoluteDifference","x1","x2","abs","y","skipFirstRow","xColumn","yColumn","tableDataRows","getTableDataRows","dataRowCounter","r","dataRow","setTableDataCellValue","table","value","cell","cellValue","numRows","numColumns","result","getNumRows","getNumColumns","c","getTableDataCellValue","defaultTable","defaultCellValue","$event","tableElement","element","canvas","img_b64","toDataURL","imageObject","getImageObjectFromBase64String","addNote","fromComponentState","toComponentState","fromStudentData","toStudentData","fromTableData","toTableData","componentStates","defaultComponentState","createBlankComponentState","copyTableDataCellText","ComponentController","$inject"],"mappings":"AAAA;;;;;;;;AAEA;;;;AACA;;;;;;;;;;;;IAEMA,e;;;AACJ,2BAAYC,aAAZ,EACIC,OADJ,EAEIC,SAFJ,EAGIC,SAHJ,EAIIC,EAJJ,EAKIC,UALJ,EAMIC,MANJ,EAOIC,iBAPJ,EAQIC,aARJ,EASIC,WATJ,EAUIC,eAVJ,EAWIC,cAXJ,EAYIC,mBAZJ,EAaIC,kBAbJ,EAcIC,YAdJ,EAeIC,WAfJ,EAeiB;AAAA;;AAAA,kIACTd,OADS,EACAE,SADA,EACWE,UADX,EACuBC,MADvB,EAEXC,iBAFW,EAEQC,aAFR,EAEuBC,WAFvB,EAGXC,eAHW,EAGMC,cAHN,EAGsBC,mBAHtB,EAIXC,kBAJW,EAISE,WAJT;;AAKf,UAAKf,aAAL,GAAqBA,aAArB;AACA,UAAKE,SAAL,GAAiBA,SAAjB;AACA,UAAKE,EAAL,GAAUA,EAAV;AACA,UAAKU,YAAL,GAAoBA,YAApB;;AAEA;AACA,UAAKE,SAAL,GAAiB,IAAjB;;AAEA;AACA,UAAKC,iBAAL,GAAyB,IAAzB;;AAEA;AACA,UAAKC,yBAAL,GAAiC,IAAjC;;AAEA;AACA,UAAKC,cAAL,GAAsB,MAAKT,eAAL,CAAqBU,iBAArB,EAAtB;;AAEA,UAAKC,6BAAL,GAAqC,IAArC;AACA,UAAKC,8BAAL,GAAsC,IAAtC;;AAEA,UAAKC,OAAL,GAAe,WAAW,MAAKC,MAAhB,GAAyB,GAAzB,GAA+B,MAAKC,WAAnD;;AAEA,QAAI,MAAKC,IAAL,KAAc,SAAlB,EAA6B;AAC3B,YAAKC,eAAL,GAAuB,IAAvB;AACA,YAAKC,mBAAL,GAA2B,MAAKC,gBAAL,CAAsBC,cAAjD;AACA,YAAKC,qBAAL,GAA6B,MAAKF,gBAAL,CAAsBG,gBAAnD;AACA,YAAKd,yBAAL,GAAiC,IAAjC;AACD,KALD,MAKO,IAAI,MAAKQ,IAAL,KAAc,SAAd,IAA2B,MAAKA,IAAL,KAAc,iBAA7C,EAAgE;AACrE,YAAKE,mBAAL,GAA2B,KAA3B;AACA,YAAKG,qBAAL,GAA6B,KAA7B;AACA,YAAKb,yBAAL,GAAiC,KAAjC;AACA,YAAKe,UAAL,GAAkB,IAAlB;AACD,KALM,MAKA,IAAI,MAAKP,IAAL,KAAc,cAAlB,EAAkC;AACvC,YAAKC,eAAL,GAAuB,KAAvB;AACA,YAAKC,mBAAL,GAA2B,KAA3B;AACA,YAAKG,qBAAL,GAA6B,KAA7B;AACA,YAAKb,yBAAL,GAAiC,KAAjC;AACA,YAAKe,UAAL,GAAkB,IAAlB;AACD,KANM,MAMA,IAAI,MAAKP,IAAL,KAAc,kBAAlB,EAAsC;AAC3C,YAAKC,eAAL,GAAuB,IAAvB;AACA,YAAKC,mBAAL,GAA2B,KAA3B;AACA,YAAKG,qBAAL,GAA6B,KAA7B;AACA,YAAKb,yBAAL,GAAiC,KAAjC;AACA,YAAKe,UAAL,GAAkB,IAAlB;AACD;;AAED,QAAIC,iBAAiB,IAArB;;AAEA;AACAA,qBAAiB,MAAK5B,MAAL,CAAY4B,cAA7B;;AAEA,QAAI,MAAKR,IAAL,IAAa,SAAjB,EAA4B;AAC1B,UAAI,MAAKX,WAAL,CAAiBoB,6BAAjB,CAA+C,MAAKN,gBAApD,CAAJ,EAA2E;AACzE;AACA,cAAKO,yBAAL;AACD,OAHD,MAGQ,IAAI,MAAKtB,YAAL,CAAkBuB,4BAAlB,CAA+CH,cAA/C,EAA+D,MAAKL,gBAApE,CAAJ,EAA2F;AACjG;;;;AAIA,cAAKS,cAAL,CAAoBJ,cAApB;AACD,OANO,MAMD,IAAI,MAAKnB,WAAL,CAAiBwB,qBAAjB,CAAuC,MAAKV,gBAA5C,CAAJ,EAAmE;AACxE;AACA,cAAKO,yBAAL;AACD,OAHM,MAGA,IAAIF,kBAAkB,IAAtB,EAA4B;AACjC;;AAEA,YAAI,MAAKnB,WAAL,CAAiBwB,qBAAjB,CAAuC,MAAKV,gBAA5C,CAAJ,EAAmE;AACjE;;;;;AAKA,gBAAKO,yBAAL;AACD;AACF;AACF,KAzBD,MAyBO;AACL;AACA,YAAKE,cAAL,CAAoBJ,cAApB;AACD;;AAED;AACA,UAAKM,UAAL;;AAEA;AACA,QAAI,MAAKX,gBAAL,CAAsBY,cAAtB,IAAwC,IAAxC,IAAgD,MAAKC,aAAL,IAAsB,MAAKb,gBAAL,CAAsBY,cAAhG,EAAgH;AAC9G;;;;AAIA,YAAKE,sBAAL,GAA8B,IAA9B;AACD;;AAED,UAAKC,2BAAL;;AAEA;;;;;;;;AAQA,UAAKtC,MAAL,CAAYuC,0CAAZ,GAAyD,UAASC,kBAAT,EAA6BC,wBAA7B,EAAuDb,cAAvD,EAAuE;;AAE9H,UAAIY,sBAAsB,IAAtB,IAA8BC,4BAA4B,IAA1D,IAAkEb,kBAAkB,IAAxF,EAA8F;;AAE5F,YAAIa,yBAAyBC,QAAzB,KAAsC,QAA1C,EAAoD,CAEnD;;AAED;AACA,YAAIC,gBAAgBH,mBAAmBI,IAAvC;;AAEA;;;;AAIAhB,yBAAiB,KAAKnB,WAAL,CAAiBoC,oBAAjB,CAAsCjB,cAAtC,CAAjB;;AAEA,YAAIe,kBAAkB,OAAtB,EAA+B;;AAE7B;AACA,eAAK3C,MAAL,CAAY8C,eAAZ,CAA4Bd,cAA5B,CAA2CJ,cAA3C;;AAEA;AACA,eAAK5B,MAAL,CAAY8C,eAAZ,CAA4BC,OAA5B,GAAsC,IAAtC;AACD,SAPD,MAOO,IAAIJ,kBAAkB,OAAtB,EAA+B;;AAEpC;AACA,eAAK3C,MAAL,CAAY8C,eAAZ,CAA4BE,yBAA5B,CAAsDpB,cAAtD,EAAsEa,wBAAtE;;AAEA;AACA,eAAKzC,MAAL,CAAY8C,eAAZ,CAA4BC,OAA5B,GAAsC,IAAtC;AACD,SAPM,MAOA,IAAIJ,kBAAkB,UAAtB,EAAkC;;AAEvC;AACA,eAAK3C,MAAL,CAAY8C,eAAZ,CAA4Bd,cAA5B,CAA2CJ,cAA3C;;AAEA;AACA,eAAK5B,MAAL,CAAY8C,eAAZ,CAA4BC,OAA5B,GAAsC,IAAtC;AACD;AACF;AACF,KAxCwD,CAwCvDE,IAxCuD,OAAzD;;AA0CA;;;;;;;;AAQA,UAAKjD,MAAL,CAAYkD,iBAAZ,GAAgC,UAASC,QAAT,EAAmB;AACjD,UAAIC,WAAW,KAAKtD,EAAL,CAAQuD,KAAR,EAAf;AACA,UAAIC,WAAW,KAAf;AACA,UAAIC,SAAS,QAAb;;AAEA,UAAIJ,QAAJ,EAAc;AACZ,YAAI,KAAKnD,MAAL,CAAY8C,eAAZ,CAA4BU,aAAhC,EAA+C;AAC7CF,qBAAW,IAAX;AACAC,mBAAS,QAAT;AACD;AACF,OALD,MAKO;AACL,YAAI,KAAKvD,MAAL,CAAY8C,eAAZ,CAA4BC,OAAhC,EAAyC;AACvCO,qBAAW,IAAX;AACAC,mBAAS,MAAT;AACD;AACF;;AAED,UAAID,QAAJ,EAAc;AACZ;AACA,aAAKtD,MAAL,CAAY8C,eAAZ,CAA4BW,oBAA5B,CAAiDF,MAAjD,EAAyDG,IAAzD,CAA8D,UAAC9B,cAAD,EAAoB;AAChFwB,mBAASO,OAAT,CAAiB/B,cAAjB;AACD,SAFD;AAGD,OALD,MAKO;AACL;;;;;AAKAwB,iBAASO,OAAT;AACD;;AAED,aAAOP,SAASQ,OAAhB;AACD,KAhC+B,CAgC9BX,IAhC8B,OAAhC;;AAkCA;;;;;AAKA,UAAKjD,MAAL,CAAY6D,GAAZ,CAAgB,UAAhB,EAA4BC,QAAQb,IAAR,QAAmB,UAASc,KAAT,EAAgBC,IAAhB,EAAsB,CAEpE,CAF2B,CAA5B;;AAIA,UAAKhE,MAAL,CAAYiE,SAAZ,GAAwB,UAASC,GAAT,EAAc;AACpC,UAAIC,QAAQ,IAAIC,KAAJ,EAAZ;;AAEA;AACA,UAAIF,OAAO,IAAP,IAAe,CAACG,MAAMH,GAAN,CAApB,EAAgC;AAC9BC,gBAAQ,IAAIC,KAAJ,CAAUE,SAASJ,GAAT,CAAV,CAAR;AACD;;AAED,aAAOC,KAAP;AACD,KATD;;AAWA,UAAKpE,UAAL,CAAgBwE,UAAhB,CAA2B,wBAA3B,EAAqD,EAAErD,QAAQ,MAAKA,MAAf,EAAuBC,aAAa,MAAKA,WAAzC,EAArD;AApNe;AAqNhB;;;;+DAE0C;AACzC;;;;AAIA,WAAKnB,MAAL,CAAY6D,GAAZ,CAAgB,0BAAhB,EAA4CC,QAAQb,IAAR,CAAa,IAAb,EAAmB,UAASc,KAAT,EAAgBC,IAAhB,EAAsB;;AAEnF,YAAIpC,iBAAiBoC,KAAKQ,WAA1B;;AAEA;AACA,YAAI5C,kBAAkB,KAAKV,MAAL,KAAgBU,eAAeV,MAAjD,IACC,KAAKC,WAAL,KAAqBS,eAAeT,WADzC,EACsD;;AAEpD;AACA,eAAK4B,OAAL,GAAe,KAAf;AACA,eAAK/C,MAAL,CAAYyE,KAAZ,CAAkB,gBAAlB,EAAoC,EAACtD,aAAa,KAAKA,WAAnB,EAAgC4B,SAAS,KAAzC,EAApC;;AAEA,cAAI2B,aAAa9C,eAAe8C,UAAhC;AACA,cAAIvB,WAAWvB,eAAeuB,QAA9B;AACA,cAAIwB,iBAAiB/C,eAAe+C,cAApC;AACA,cAAIC,iBAAiB,KAAK1E,aAAL,CAAmB2E,wBAAnB,CAA4CF,cAA5C,CAArB;;AAEA,cAAIxB,QAAJ,EAAc;AACZ,iBAAK2B,mBAAL,CAAyBF,cAAzB;AACA,iBAAKG,eAAL;;AAEA;AACA,iBAAKvB,aAAL,GAAqB,KAArB;AACA,iBAAKxD,MAAL,CAAYyE,KAAZ,CAAkB,sBAAlB,EAA0C,EAACtD,aAAa,KAAKA,WAAnB,EAAgC4B,SAAS,KAAzC,EAA1C;AACD,WAPD,MAOO,IAAI2B,UAAJ,EAAgB;AACrB,iBAAKM,mBAAL,CAAyBJ,cAAzB;AACD,WAFM,MAEA;AACL,iBAAKK,eAAL,CAAqBL,cAArB;AACD;AACF;;AAED;AACA,YAAI,KAAKvE,cAAL,CAAoB6E,oBAApB,CAAyC,KAAKhE,MAA9C,EAAsD,KAAKC,WAA3D,EAAwES,eAAeT,WAAvF,CAAJ,EAAyG;;AAEvG;AACA,cAAIsB,2BAA2B,KAAKpC,cAAL,CAAoB8E,2BAApB,CAAgD,KAAK5D,gBAArD,EAAuEK,eAAeT,WAAtF,CAA/B;;AAEA,cAAIsB,4BAA4B,IAAhC,EAAsC;;AAEpC,gBAAIA,yBAAyBC,QAAzB,KAAsC,MAAtC,IACDD,yBAAyBC,QAAzB,KAAsC,QAAtC,IAAkDd,eAAeuB,QADpE,EAC+E;;AAE7E,kBAAIiC,gBAAgB,KAApB;;AAEA;;;;AAIAxD,+BAAiB,KAAKnB,WAAL,CAAiBoC,oBAAjB,CAAsCjB,cAAtC,CAAjB;;AAEA;;;;AAIA,kBAAI,KAAKyD,YAAL,MAAuB,KAAKC,YAAL,EAA3B,EAAgD;AAC9C;;;;AAIAF,gCAAgB,IAAhB;AACD,eAND,MAMO;AACL;;;;AAIA;;;;;;;AAQAA,gCAAgB,IAAhB;AACD;;AAED,kBAAIA,aAAJ,EAAmB;AACjB;AACA,qBAAKpF,MAAL,CAAY8C,eAAZ,CAA4Bd,cAA5B,CAA2CJ,cAA3C;;AAEA;AACA,qBAAK5B,MAAL,CAAY8C,eAAZ,CAA4BC,OAA5B,GAAsC,IAAtC;AACA,qBAAK/C,MAAL,CAAY8C,eAAZ,CAA4BU,aAA5B,GAA4C,IAA5C;AACD;;AAED;;;;AAIA,mBAAKzC,6BAAL,GAAqCa,cAArC;AACA,mBAAKZ,8BAAL,GAAsCyB,wBAAtC;AACD;AACF;AACF;AACF,OA9F2C,CAA5C;AA+FD;;;uCAEkB;AACjB,WAAK8C,MAAL,CAAY,kBAAZ;AACD;;AAED;;;;;;;;uCAKmB7E,S,EAAW;AAC5B,UAAI8E,gBAAgB,IAApB;;AAEA,UAAI9E,aAAa,IAAjB,EAAuB;AACrB;AACA,YAAI+E,sBAAsBC,KAAKC,SAAL,CAAejF,SAAf,CAA1B;;AAEA;AACA,YAAIkF,gBAAgBF,KAAKG,KAAL,CAAWJ,mBAAX,CAApB;;AAEAD,wBAAgBI,aAAhB;AACD;;AAED,aAAOJ,aAAP;AACD;;;;;AAED;;;iCAGa;;AAEX,UAAI,KAAK9E,SAAL,IAAkB,IAAtB,EAA4B;AAC1B;;;;AAIA,aAAKA,SAAL,GAAiB,KAAKoF,kBAAL,CAAwB,KAAKvE,gBAAL,CAAsBb,SAA9C,CAAjB;AACD;AACF;;;;;AAED;;;iCAGa;AACX,UAAI,KAAKD,WAAL,CAAiBwB,qBAAjB,CAAuC,KAAKV,gBAA5C,CAAJ,EAAmE;AACjE;AACA,aAAKO,yBAAL;AACD,OAHD,MAGO;AACL;AACA,aAAKpB,SAAL,GAAiB,KAAKoF,kBAAL,CAAwB,KAAKvE,gBAAL,CAAsBb,SAA9C,CAAjB;AACA,aAAKqF,kBAAL;AACD;AACF;;;;;AAED;;;uCAGmB;AACjB,aAAO,KAAKrF,SAAZ;AACD;;;;;AAED;;;;mCAIekB,c,EAAgB;;AAE7B,UAAIA,kBAAkB,IAAtB,EAA4B;;AAE1B;AACA,YAAIoE,cAAcpE,eAAeoE,WAAjC;;AAEA,YAAIA,eAAe,IAAnB,EAAyB;AACvB;AACA,eAAKtF,SAAL,GAAiBsF,YAAYtF,SAA7B;;AAEA,cAAI0B,gBAAgB4D,YAAY5D,aAAhC;;AAEA,cAAIA,iBAAiB,IAArB,EAA2B;AACzB;AACA,iBAAKA,aAAL,GAAqBA,aAArB;AACD;;AAED,eAAK6D,wBAAL;AACD;AACF;AACF;;AAED;;;;;;;;;yCAMqB1C,M,EAAQ;;AAE3B,UAAIH,WAAW,KAAKtD,EAAL,CAAQuD,KAAR,EAAf;;AAEA;AACA,UAAIzB,iBAAiB,KAAKzB,WAAL,CAAiB+F,uBAAjB,EAArB;;AAEA,UAAIF,cAAc,EAAlB;;AAEA;AACAA,kBAAYtF,SAAZ,GAAwB,KAAKoF,kBAAL,CAAwB,KAAKpF,SAA7B,CAAxB;;AAEA;AACAsF,kBAAY5D,aAAZ,GAA4B,KAAKA,aAAjC;;AAEA;AACAR,qBAAeuB,QAAf,GAA0B,KAAKA,QAA/B;;AAEA;AACAvB,qBAAeoE,WAAf,GAA6BA,WAA7B;;AAEA;AACApE,qBAAee,aAAf,GAA+B,OAA/B;;AAEA;AACAf,qBAAeV,MAAf,GAAwB,KAAKA,MAA7B;;AAEA;AACAU,qBAAeT,WAAf,GAA6B,KAAKA,WAAlC;;AAEA;;;;AAIA,WAAKgC,QAAL,GAAgB,KAAhB;;AAEA;;;;AAIA,WAAKgD,wCAAL,CAA8C/C,QAA9C,EAAwDxB,cAAxD,EAAwE2B,MAAxE;;AAEA,aAAOH,SAASQ,OAAhB;AACD;;;;;AAED;;;;gDAI4B;;AAE1B;AACA,UAAIhC,iBAAiB,KAAKzB,WAAL,CAAiB+F,uBAAjB,EAArB;;AAEA,UAAItE,kBAAkB,IAAtB,EAA4B;AAC1B,YAAIoE,cAAc,EAAlB;;AAEA;AACApE,uBAAeoE,WAAf,GAA6BA,WAA7B;AACD;;AAED,aAAOpE,cAAP;AACD;;;;;AAED;;;;2CAIuB;AACrB,aAAO,KAAKhB,yBAAZ;AACD;;;;;AAED;;;;;;8CAM0BgB,c,EAAgBwE,M,EAAQ;;AAEhD,UAAIC,aAAa,CAAjB;AACA,UAAIC,cAAc,CAAlB;;AAEA,UAAIF,UAAU,IAAd,EAAoB;;AAElB,YAAIA,OAAOC,UAAP,IAAqB,IAAzB,EAA+B;AAC7B;AACAA,uBAAaD,OAAOC,UAApB;AACD;;AAED,YAAID,OAAOE,WAAP,IAAsB,IAA1B,EAAgC;AAC9B;AACAA,wBAAcF,OAAOE,WAArB;AACD;;AAED,YAAIF,OAAOG,gBAAX,EAA6B;AAC3B,eAAKA,gBAAL,CAAsB3E,cAAtB,EAAsCwE,MAAtC;AACA;AACD;AACF;;AAED,UAAIxE,kBAAkB,IAAlB,IAA0BA,eAAeoE,WAAf,IAA8B,IAA5D,EAAkE;;AAEhE;AACA,YAAIA,cAAcpE,eAAeoE,WAAjC;;AAEA;AACA,YAAIQ,qBAAqBR,YAAYS,OAArC;;AAEA,YAAID,sBAAsB,IAAtB,IAA8BA,sBAAsB,CAAxD,EAA2D;AACzD;;AAEA;AACA,cAAIE,SAASV,YAAYU,MAAzB;;AAEA,cAAIA,UAAU,IAAV,IAAkBA,OAAOC,MAAP,GAAgB,CAAtC,EAAyC;;AAEvC;AACA,gBAAIC,aAAaF,OAAOJ,WAAP,CAAjB;;AAEA;AACA,iBAAKO,kBAAL,CAAwBD,UAAxB;AACD;AACF,SAdD,MAcO;AACL;;AAEA;AACA,cAAIE,SAASd,YAAYc,MAAzB;;AAEA,cAAIA,UAAU,IAAd,EAAoB;;AAElB;AACA,gBAAIC,QAAQD,OAAOT,UAAP,CAAZ;;AAEA,gBAAIU,SAAS,IAAb,EAAmB;;AAEjB;AACA,kBAAIC,iBAAiBD,MAAML,MAA3B;;AAEA,kBAAIM,kBAAkB,IAAtB,EAA4B;;AAE1B;AACA,oBAAIN,SAASM,eAAeV,WAAf,CAAb;;AAEA;AACA,qBAAKO,kBAAL,CAAwBH,MAAxB;AACD;AACF;AACF;AACF;AACF;AACF;;;;;AAED;;;;;qCAKiB9E,c,EAAgBwE,M,EAAQ;AACvC,UAAIJ,cAAcpE,eAAeoE,WAAjC;AACA,UAAIiB,kBAAkBjB,YAAYiB,eAAlC;AACA,UAAIC,IAAI,IAAR;;AAEA;AACA,UAAID,mBAAmB,IAAnB,IAA2BA,gBAAgBN,MAAhB,GAAyB,CAAxD,EAA2D;AACzD,YAAIQ,uBAAuBF,gBAAgBA,gBAAgBN,MAAhB,GAAyB,CAAzC,CAA3B;AACAO,YAAIE,KAAKC,KAAL,CAAWF,qBAAqB,CAArB,CAAX,CAAJ;AACD;AACD,UAAIG,SAAStB,YAAYuB,KAAZ,CAAkBC,KAA/B;AACA,UAAIC,SAASzB,YAAY0B,KAAZ,CAAkBF,KAA/B;AACA,UAAIG,aAAa3B,YAAYuB,KAAZ,CAAkBK,KAAlB,CAAwBC,IAAzC;AACA,UAAIC,aAAa9B,YAAY0B,KAAZ,CAAkBE,KAAlB,CAAwBC,IAAzC;AACA,WAAKE,2BAAL;AACA,WAAKC,eAAL,CAAqB,KAAKC,cAAL,CAAoB,CAAC,aAAD,EAAgBN,UAAhB,EAA4BG,UAA5B,CAApB,CAArB;AAfuC;AAAA;AAAA;;AAAA;AAgBvC,6BAAkB9B,YAAYc,MAA9B,8HAAsC;AAAA,cAA7BC,KAA6B;;AACpC,cAAIA,MAAMmB,IAAV,EAAgB;AACd,gBAAIlB,iBAAiBD,MAAML,MAA3B;AADc;AAAA;AAAA;;AAAA;AAEd,oCAAyBM,cAAzB,mIAAyC;AAAA,oBAAhCmB,YAAgC;;AACvC,oBAAIA,aAAaD,IAAb,KAAsB,KAA1B,EAAiC;AAC/B,sBAAIE,mBAAmB,KAAKC,mBAAL,CAAyBF,aAAaG,IAAtC,EAA4CpB,CAA5C,CAAvB;AACA,sBAAIkB,oBAAoB,IAAxB,EAA8B;AAC5B,yBAAKJ,eAAL,CAAqB,KAAKC,cAAL,CAAoB,CAACE,aAAaI,IAAd,EACrCnB,KAAKC,KAAL,CAAW,KAAKmB,iBAAL,CAAuBJ,gBAAvB,CAAX,IAAuD,GAAvD,GAA6Dd,MADxB,EAErCF,KAAKC,KAAL,CAAW,KAAKoB,iBAAL,CAAuBL,gBAAvB,CAAX,IAAuD,GAAvD,GAA6DX,MAFxB,CAApB,CAArB;AAGD;AACF;AACF;AAXa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYf;AACF;AA9BsC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA+BxC;;AAED;;;;;;kDAG8B;AAC5B,WAAK/G,SAAL,GAAiB,EAAjB;AACD;;AAED;;;;;;;oCAIgBgI,G,EAAK;AACnB,WAAKhI,SAAL,CAAeiI,IAAf,CAAoBD,GAApB;AACD;;AAED;;;;;;;;;;;sCAQ0D;AAAA,UAA1Cb,IAA0C,uEAAnC,EAAmC;AAAA,UAA/Be,QAA+B,uEAApB,KAAoB;AAAA,UAAbC,IAAa,uEAAN,IAAM;;AACxD,aAAO,EAAEhB,MAAMA,IAAR,EAAce,UAAUA,QAAxB,EAAkCC,MAAMA,IAAxC,EAAP;AACD;;AAED;;;;;;;;mCAKeC,O,EAAS;AACtB,UAAIJ,MAAM,EAAV;AADsB;AAAA;AAAA;;AAAA;AAEtB,8BAAmBI,OAAnB,mIAA4B;AAAA,cAAnBC,MAAmB;;AAC1B,cAAIA,OAAOC,WAAP,CAAmBT,IAAnB,IAA2B,QAA/B,EAAyC;AACvCG,gBAAIC,IAAJ,CAAS,KAAKM,eAAL,CAAqBF,MAArB,CAAT;AACD,WAFD,MAEO,IAAIA,OAAOC,WAAP,CAAmBT,IAAnB,IAA2B,QAA/B,EAAyC;AAC9CG,gBAAIC,IAAJ,CAAS,KAAKM,eAAL,CAAqBF,OAAOlB,IAA5B,EAAkCkB,OAAOH,QAAzC,EAAmDG,OAAOF,IAA1D,CAAT;AACD;AACF;AARqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAStB,aAAOH,GAAP;AACD;;AAED;;;;;;;;;;wCAOoBQ,U,EAAYhC,C,EAAG;AACjC,UAAIkB,mBAAmB,IAAvB;AACA,UAAIe,0BAA0BC,QAA9B;AAFiC;AAAA;AAAA;;AAAA;AAGjC,8BAAsBF,UAAtB,mIAAkC;AAAA,cAAzBG,SAAyB;;AAChC,cAAIC,aAAa,KAAKd,iBAAL,CAAuBa,SAAvB,CAAjB;AACA,cAAIE,sBAAsB,KAAKC,8BAAL,CAAoCtC,CAApC,EAAuCoC,UAAvC,CAA1B;AACA,cAAIC,sBAAsBJ,uBAA1B,EAAmD;AACjD;AACAf,+BAAmBiB,SAAnB;AACAF,sCAA0BI,mBAA1B;AACD;AACF;AAXgC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAYjC,aAAOnB,gBAAP;AACD;;AAED;;;;;;;;;mDAM+BqB,E,EAAIC,E,EAAI;AACrC,aAAOtC,KAAKuC,GAAL,CAASF,KAAKC,EAAd,CAAP;AACD;;AAED;;;;;;;;sCAKkBL,S,EAAW;AAC3B,UAAIA,UAAUL,WAAV,CAAsBT,IAAtB,IAA8B,QAAlC,EAA4C;AAC1C,eAAOc,UAAUnC,CAAjB;AACD,OAFD,MAEO,IAAImC,UAAUL,WAAV,CAAsBT,IAAtB,IAA8B,OAAlC,EAA2C;AAChD,eAAOc,UAAU,CAAV,CAAP;AACD;AACF;;AAED;;;;;;;;sCAKkBA,S,EAAW;AAC3B,UAAIA,UAAUL,WAAV,CAAsBT,IAAtB,IAA8B,QAAlC,EAA4C;AAC1C,eAAOc,UAAUO,CAAjB;AACD,OAFD,MAEO,IAAIP,UAAUL,WAAV,CAAsBT,IAAtB,IAA8B,OAAlC,EAA2C;AAChD,eAAOc,UAAU,CAAV,CAAP;AACD;AACF;;AAED;;;;;;;;uCAKmB3C,M,EAAQN,M,EAAQ;;AAEjC;;;;;AAKA,UAAIyD,eAAe,IAAnB;AACA,UAAIC,UAAU,CAAd;AACA,UAAIC,UAAU,CAAd;;AAEA,UAAI3D,UAAU,IAAd,EAAoB;;AAElB,YAAIA,OAAOyD,YAAP,IAAuB,IAA3B,EAAiC;AAC/B;AACAA,yBAAezD,OAAOyD,YAAtB;AACD;;AAED,YAAIzD,OAAO0D,OAAP,IAAkB,IAAtB,EAA4B;AAC1B;AACAA,oBAAU1D,OAAO0D,OAAjB;AACD;;AAED,YAAI1D,OAAO2D,OAAP,IAAkB,IAAtB,EAA4B;AAC1B;AACAA,oBAAU3D,OAAO2D,OAAjB;AACD;AACF;;AAED,UAAIrD,UAAU,IAAd,EAAoB;;AAElB;AACA,YAAIsD,gBAAgB,KAAKC,gBAAL,EAApB;;AAEA;AACA,YAAI3B,OAAO5B,OAAO4B,IAAlB;;AAEA,YAAIA,QAAQ,IAAZ,EAAkB;;AAEhB;AACA,cAAI4B,iBAAiB,CAArB;;AAEA;AACA,eAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIH,cAAcrD,MAAlC,EAA0CwD,GAA1C,EAA+C;;AAE7C,gBAAIN,gBAAgBM,MAAM,CAA1B,EAA6B;AAC3B;AACA;AACD;;AAED,gBAAIjD,IAAI,EAAR;AACA,gBAAI0C,IAAI,EAAR;;AAEA;AACA,gBAAIQ,UAAU9B,KAAK4B,cAAL,CAAd;;AAEA,gBAAIE,WAAW,IAAf,EAAqB;AACnB;AACAlD,kBAAIkD,QAAQ,CAAR,CAAJ;AACAR,kBAAIQ,QAAQ,CAAR,CAAJ;AACD;;AAED;AACA,iBAAKC,qBAAL,CAA2BP,OAA3B,EAAoCK,CAApC,EAAuC,IAAvC,EAA6CjD,CAA7C;AACA,iBAAKmD,qBAAL,CAA2BN,OAA3B,EAAoCI,CAApC,EAAuC,IAAvC,EAA6CP,CAA7C;;AAEA;AACAM;AACD;AACF;AACF;AACF;;AAED;;;;;;;;;0CAMsBhD,C,EAAG0C,C,EAAGU,K,EAAOC,K,EAAO;;AAExC,UAAIP,gBAAgBM,KAApB;;AAEA,UAAIA,SAAS,IAAb,EAAmB;AACjB;AACAN,wBAAgB,KAAKC,gBAAL,EAAhB;AACD;;AAED,UAAID,iBAAiB,IAArB,EAA2B;;AAEzB;AACA,YAAItB,MAAMsB,cAAcJ,CAAd,CAAV;;AAEA,YAAIlB,OAAO,IAAX,EAAiB;;AAEf;AACA,cAAI8B,OAAO9B,IAAIxB,CAAJ,CAAX;;AAEA,cAAIsD,QAAQ,IAAZ,EAAkB;;AAEhB;AACAA,iBAAK3C,IAAL,GAAY0C,KAAZ;AACD;AACF;AACF;AACF;;;;;AAED;;;;;;;;0CAQsBrD,C,EAAG0C,C,EAAGU,K,EAAO;;AAEjC,UAAIG,YAAY,IAAhB;;AAEA,UAAIH,SAAS,IAAb,EAAmB;AACjB;AACAA,gBAAQ,KAAKL,gBAAL,EAAR;AACD;;AAED,UAAIK,SAAS,IAAb,EAAmB;;AAEjB;AACA,YAAI5B,MAAM4B,MAAMV,CAAN,CAAV;;AAEA,YAAIlB,OAAO,IAAX,EAAiB;;AAEf;AACA,cAAI8B,OAAO9B,IAAIxB,CAAJ,CAAX;;AAEA,cAAIsD,QAAQ,IAAZ,EAAkB;;AAEhB;AACAC,wBAAYD,KAAK3C,IAAjB;AACD;AACF;AACF;;AAED,aAAO4C,SAAP;AACD;;AAED;;;;;;;iCAIa;AACX,aAAO,KAAKlJ,gBAAL,CAAsBmJ,OAA7B;AACD;;AAED;;;;;;;oCAIgB;AACd,aAAO,KAAKnJ,gBAAL,CAAsBoJ,UAA7B;AACD;;AAED;;;;;;;;mCAKe;AACb,UAAIC,SAAS,IAAb;;AAEA,UAAIF,UAAU,KAAKG,UAAL,EAAd;AACA,UAAIF,aAAa,KAAKG,aAAL,EAAjB;;AAEA;AACA,WAAK,IAAIX,IAAI,CAAb,EAAgBA,IAAIO,OAApB,EAA6BP,GAA7B,EAAkC;;AAEhC;AACA,aAAK,IAAIY,IAAI,CAAb,EAAgBA,IAAIJ,UAApB,EAAgCI,GAAhC,EAAqC;;AAEnC;AACA,cAAIN,YAAY,KAAKO,qBAAL,CAA2BD,CAA3B,EAA8BZ,CAA9B,CAAhB;;AAEA,cAAIM,aAAa,IAAb,IAAqBA,aAAa,EAAtC,EAA0C;AACxC;AACAG,qBAAS,KAAT;AACA;AACD;AACF;;AAED,YAAIA,UAAU,KAAd,EAAqB;AACnB;AACD;AACF;;AAED,aAAOA,MAAP;AACD;;AAED;;;;;;;;;mCAMe;AACb,UAAIA,SAAS,IAAb;;AAEA,UAAIF,UAAU,KAAKG,UAAL,EAAd;AACA,UAAIF,aAAa,KAAKG,aAAL,EAAjB;;AAEA;AACA,UAAIG,eAAe,KAAK1J,gBAAL,CAAsBb,SAAzC;;AAEA;AACA,WAAK,IAAIyJ,IAAI,CAAb,EAAgBA,IAAIO,OAApB,EAA6BP,GAA7B,EAAkC;;AAEhC;AACA,aAAK,IAAIY,IAAI,CAAb,EAAgBA,IAAIJ,UAApB,EAAgCI,GAAhC,EAAqC;;AAEnC;AACA,cAAIN,YAAY,KAAKO,qBAAL,CAA2BD,CAA3B,EAA8BZ,CAA9B,CAAhB;;AAEA;AACA,cAAIe,mBAAmB,KAAKF,qBAAL,CAA2BD,CAA3B,EAA8BZ,CAA9B,EAAiCc,YAAjC,CAAvB;;AAEA,cAAIR,aAAaS,gBAAjB,EAAmC;AACjC;AACAN,qBAAS,KAAT;AACA;AACD;AACF;;AAED,YAAIA,UAAU,KAAd,EAAqB;AACnB;AACD;AACF;;AAED,aAAOA,MAAP;AACD;;AAED;;;;;;;8BAIUO,M,EAAQ;AAAA;;AAChB;AACA,UAAIC,eAAetH,QAAQuH,OAAR,CAAgB,YAAY,KAAKnK,MAAjB,GAA0B,GAA1B,GAAgC,KAAKC,WAArD,CAAnB;;AAEA,UAAIiK,gBAAgB,IAAhB,IAAwBA,aAAazE,MAAb,GAAsB,CAAlD,EAAqD;AACnD;AACAyE,uBAAeA,aAAa,CAAb,CAAf;;AAEA;AACA,mCAAYA,YAAZ,EAA0B1H,IAA1B,CAA+B,UAAC4H,MAAD,EAAY;AACzC;AACA,cAAIC,UAAUD,OAAOE,SAAP,CAAiB,WAAjB,CAAd;;AAEA;AACA,cAAIC,cAAc,OAAKhL,WAAL,CAAiBiL,8BAAjB,CAAgDH,OAAhD,CAAlB;;AAEA;AACA,iBAAKnL,eAAL,CAAqBuL,OAArB,CAA6BR,MAA7B,EAAqCM,WAArC;AACD,SATD;AAUD;AACF;;AAED;;;;;;;;0CAKsBG,kB,EAAoBC,gB,EAAkB;;AAE1D,UAAID,sBAAsB,IAAtB,IAA8BC,oBAAoB,IAAtD,EAA4D;AAC1D,YAAIC,kBAAkBF,mBAAmB5F,WAAzC;AACA,YAAI+F,gBAAgBF,iBAAiB7F,WAArC;;AAEA,YAAI8F,mBAAmB,IAAnB,IAA2BC,iBAAiB,IAAhD,EAAsD;AACpD,cAAIC,gBAAgBF,gBAAgBpL,SAApC;AACA,cAAIuL,cAAcF,cAAcrL,SAAhC;;AAEA,cAAIsL,iBAAiB,IAAjB,GAAwBC,eAAe,IAA3C,EAAiD;;AAE/C;AACA,iBAAK,IAAIrC,IAAI,CAAb,EAAgBA,IAAI,KAAKiB,UAAL,EAApB,EAAuCjB,GAAvC,EAA4C;;AAE1C;AACA,mBAAK,IAAI1C,IAAI,CAAb,EAAgBA,IAAI,KAAK4D,aAAL,EAApB,EAA0C5D,GAA1C,EAA+C;;AAE7C;AACA,oBAAIuD,YAAY,KAAKO,qBAAL,CAA2B9D,CAA3B,EAA8B0C,CAA9B,EAAiCoC,aAAjC,CAAhB;;AAEA,oBAAIvB,aAAa,IAAjB,EAAuB;AACrB;AACA,uBAAKJ,qBAAL,CAA2BnD,CAA3B,EAA8B0C,CAA9B,EAAiCqC,WAAjC,EAA8CxB,SAA9C;AACD;AACF;AACF;AACF;AACF;AACF;;AAED,aAAOoB,gBAAP;AACD;;AAED;;;;;;;;;+CAM2BK,e,EAAiB;AAC1C,UAAMC,wBAAwB,KAAKC,yBAAL,EAA9B;AACAD,4BAAsBnG,WAAtB,CAAkCtF,SAAlC,GAA8C,KAAKoF,kBAAL,CAAwB,KAAKvE,gBAAL,CAAsBb,SAA9C,CAA9C;AACA,aAAO,KAAK2L,qBAAL,CAA2BH,gBAAgB,CAAhB,CAA3B,EAA+CC,qBAA/C,CAAP;AACD;;;;EA7gC2BG,6B;;AAghC9B7M,gBAAgB8M,OAAhB,GAA0B,CACxB,eADwB,EAExB,SAFwB,EAGxB,WAHwB,EAIxB,WAJwB,EAKxB,IALwB,EAMxB,YANwB,EAOxB,QAPwB,EAQxB,mBARwB,EASxB,eATwB,EAUxB,aAVwB,EAWxB,iBAXwB,EAYxB,gBAZwB,EAaxB,qBAbwB,EAcxB,oBAdwB,EAexB,cAfwB,EAgBxB,aAhBwB,CAA1B;;kBAmBe9M,e","file":"tableController.js","sourcesContent":["'use strict';\n\nimport ComponentController from \"../componentController\";\nimport html2canvas from 'html2canvas';\n\nclass TableController extends ComponentController {\n  constructor($anchorScroll,\n      $filter,\n      $location,\n      $mdDialog,\n      $q,\n      $rootScope,\n      $scope,\n      AnnotationService,\n      ConfigService,\n      NodeService,\n      NotebookService,\n      ProjectService,\n      StudentAssetService,\n      StudentDataService,\n      TableService,\n      UtilService) {\n    super($filter, $mdDialog, $rootScope, $scope,\n        AnnotationService, ConfigService, NodeService,\n        NotebookService, ProjectService, StudentAssetService,\n        StudentDataService, UtilService);\n    this.$anchorScroll = $anchorScroll;\n    this.$location = $location;\n    this.$q = $q;\n    this.TableService = TableService;\n\n    // holds the the table data\n    this.tableData = null;\n\n    // the latest annotations\n    this.latestAnnotations = null;\n\n    // whether the reset table button is shown or not\n    this.isResetTableButtonVisible = true;\n\n    // the label for the notebook in thos project\n    this.notebookConfig = this.NotebookService.getNotebookConfig();\n\n    this.latestConnectedComponentState = null;\n    this.latestConnectedComponentParams = null;\n\n    this.tableId = 'table_' + this.nodeId + '_' + this.componentId;\n\n    if (this.mode === 'student') {\n      this.isPromptVisible = true;\n      this.isSaveButtonVisible = this.componentContent.showSaveButton;\n      this.isSubmitButtonVisible = this.componentContent.showSubmitButton;\n      this.isResetTableButtonVisible = true;\n    } else if (this.mode === 'grading' || this.mode === 'gradingRevision') {\n      this.isSaveButtonVisible = false;\n      this.isSubmitButtonVisible = false;\n      this.isResetTableButtonVisible = false;\n      this.isDisabled = true;\n    } else if (this.mode === 'onlyShowWork') {\n      this.isPromptVisible = false;\n      this.isSaveButtonVisible = false;\n      this.isSubmitButtonVisible = false;\n      this.isResetTableButtonVisible = false;\n      this.isDisabled = true;\n    } else if (this.mode === 'showPreviousWork') {\n      this.isPromptVisible = true;\n      this.isSaveButtonVisible = false;\n      this.isSubmitButtonVisible = false;\n      this.isResetTableButtonVisible = false;\n      this.isDisabled = true;\n    }\n\n    var componentState = null;\n\n    // get the component state from the scope\n    componentState = this.$scope.componentState;\n\n    if (this.mode == 'student') {\n      if (this.UtilService.hasShowWorkConnectedComponent(this.componentContent)) {\n        // we will show work from another component\n        this.handleConnectedComponents();\n      }  else if (this.TableService.componentStateHasStudentWork(componentState, this.componentContent)) {\n        /*\n         * the student has work so we will populate the work into this\n         * component\n         */\n        this.setStudentWork(componentState);\n      } else if (this.UtilService.hasConnectedComponent(this.componentContent)) {\n        // we will import work from another component\n        this.handleConnectedComponents();\n      } else if (componentState == null) {\n        // check if we need to import work\n\n        if (this.UtilService.hasConnectedComponent(this.componentContent)) {\n          /*\n           * the student does not have any work and there are connected\n           * components so we will get the work from the connected\n           * components\n           */\n          this.handleConnectedComponents();\n        }\n      }\n    } else {\n      // populate the student work into this component\n      this.setStudentWork(componentState);\n    }\n\n    // set up the table\n    this.setupTable();\n\n    // check if the student has used up all of their submits\n    if (this.componentContent.maxSubmitCount != null && this.submitCounter >= this.componentContent.maxSubmitCount) {\n      /*\n       * the student has used up all of their chances to submit so we\n       * will disable the submit button\n       */\n      this.isSubmitButtonDisabled = true;\n    }\n\n    this.disableComponentIfNecessary();\n\n    /**\n     * A connected component has changed its student data so we will\n     * perform any necessary changes to this component\n     * @param connectedComponent the connected component\n     * @param connectedComponentParams the connected component params\n     * @param componentState the component state from the connected\n     * component that has changed\n     */\n    this.$scope.handleConnectedComponentStudentDataChanged = function(connectedComponent, connectedComponentParams, componentState) {\n\n      if (connectedComponent != null && connectedComponentParams != null && componentState != null) {\n\n        if (connectedComponentParams.updateOn === 'change') {\n\n        }\n\n        // get the component type that has changed\n        var componentType = connectedComponent.type;\n\n        /*\n         * make a copy of the component state so we don't accidentally\n         * change any values in the referenced object\n         */\n        componentState = this.UtilService.makeCopyOfJSONObject(componentState);\n\n        if (componentType === 'Table') {\n\n          // set the table data\n          this.$scope.tableController.setStudentWork(componentState);\n\n          // the table has changed\n          this.$scope.tableController.isDirty = true;\n        } else if (componentType === 'Graph') {\n\n          // set the graph data into the table\n          this.$scope.tableController.setGraphDataIntoTableData(componentState, connectedComponentParams);\n\n          // the table has changed\n          this.$scope.tableController.isDirty = true;\n        } else if (componentType === 'Embedded') {\n\n          // set the table data\n          this.$scope.tableController.setStudentWork(componentState);\n\n          // the table has changed\n          this.$scope.tableController.isDirty = true;\n        }\n      }\n    }.bind(this);\n\n    /**\n     * Get the component state from this component. The parent node will\n     * call this function to obtain the component state when it needs to\n     * save student data.\n     * @param isSubmit boolean whether the request is coming from a submit\n     * action (optional; default is false)\n     * @return a promise of a component state containing the student data\n     */\n    this.$scope.getComponentState = function(isSubmit) {\n      var deferred = this.$q.defer();\n      let getState = false;\n      let action = 'change';\n\n      if (isSubmit) {\n        if (this.$scope.tableController.isSubmitDirty) {\n          getState = true;\n          action = 'submit';\n        }\n      } else {\n        if (this.$scope.tableController.isDirty) {\n          getState = true;\n          action = 'save';\n        }\n      }\n\n      if (getState) {\n        // create a component state populated with the student data\n        this.$scope.tableController.createComponentState(action).then((componentState) => {\n          deferred.resolve(componentState);\n        });\n      } else {\n        /*\n         * the student does not have any unsaved changes in this component\n         * so we don't need to save a component state for this component.\n         * we will immediately resolve the promise here.\n         */\n        deferred.resolve();\n      }\n\n      return deferred.promise;\n    }.bind(this);\n\n    /**\n     * Listen for the 'exitNode' event which is fired when the student\n     * exits the parent node. This will perform any necessary cleanup\n     * when the student exits the parent node.\n     */\n    this.$scope.$on('exitNode', angular.bind(this, function(event, args) {\n\n    }));\n\n    this.$scope.getNumber = function(num) {\n      var array = new Array();\n\n      // make sure num is a valid number\n      if (num != null && !isNaN(num)) {\n        array = new Array(parseInt(num));\n      }\n\n      return array;\n    }\n\n    this.$rootScope.$broadcast('doneRenderingComponent', { nodeId: this.nodeId, componentId: this.componentId });\n  }\n\n  registerStudentWorkSavedToServerListener() {\n    /**\n     * Listen for the 'studentWorkSavedToServer' event which is fired when\n     * we receive the response from saving a component state to the server\n     */\n    this.$scope.$on('studentWorkSavedToServer', angular.bind(this, function(event, args) {\n\n      let componentState = args.studentWork;\n\n      // check that the component state is for this component\n      if (componentState && this.nodeId === componentState.nodeId\n        && this.componentId === componentState.componentId) {\n\n        // set isDirty to false because the component state was just saved and notify node\n        this.isDirty = false;\n        this.$scope.$emit('componentDirty', {componentId: this.componentId, isDirty: false});\n\n        let isAutoSave = componentState.isAutoSave;\n        let isSubmit = componentState.isSubmit;\n        let serverSaveTime = componentState.serverSaveTime;\n        let clientSaveTime = this.ConfigService.convertToClientTimestamp(serverSaveTime);\n\n        if (isSubmit) {\n          this.setSubmittedMessage(clientSaveTime);\n          this.lockIfNecessary();\n\n          // set isSubmitDirty to false because the component state was just submitted and notify node\n          this.isSubmitDirty = false;\n          this.$scope.$emit('componentSubmitDirty', {componentId: this.componentId, isDirty: false});\n        } else if (isAutoSave) {\n          this.setAutoSavedMessage(clientSaveTime);\n        } else {\n          this.setSavedMessage(clientSaveTime);\n        }\n      }\n\n      // check if the component state is from a connected component\n      if (this.ProjectService.isConnectedComponent(this.nodeId, this.componentId, componentState.componentId)) {\n\n        // get the connected component params\n        var connectedComponentParams = this.ProjectService.getConnectedComponentParams(this.componentContent, componentState.componentId);\n\n        if (connectedComponentParams != null) {\n\n          if (connectedComponentParams.updateOn === 'save' ||\n            (connectedComponentParams.updateOn === 'submit' && componentState.isSubmit)) {\n\n            var performUpdate = false;\n\n            /*\n             * make a copy of the component state so we don't accidentally\n             * change any values in the referenced object\n             */\n            componentState = this.UtilService.makeCopyOfJSONObject(componentState);\n\n            /*\n             * make sure the student hasn't entered any values into the\n             * table so that we don't overwrite any of their work.\n             */\n            if (this.isTableEmpty() || this.isTableReset()) {\n              /*\n               * the student has not entered any values into the table\n               * so we can update it\n               */\n              performUpdate = true;\n            } else {\n              /*\n               * the student has entered values into the table so we\n               * will ask them if they want to update it\n               */\n              /*\n              var answer = confirm('Do you want to update the connected table?');\n\n              if (answer) {\n                // the student answered yes\n                performUpdate = true;\n              }\n              */\n              performUpdate = true;\n            }\n\n            if (performUpdate) {\n              // set the table data\n              this.$scope.tableController.setStudentWork(componentState);\n\n              // the table has changed\n              this.$scope.tableController.isDirty = true;\n              this.$scope.tableController.isSubmitDirty = true;\n            }\n\n            /*\n             * remember the component state and connected component params\n             * in case we need to use them again later\n             */\n            this.latestConnectedComponentState = componentState;\n            this.latestConnectedComponentParams = connectedComponentParams;\n          }\n        }\n      }\n    }));\n  }\n\n  handleNodeSubmit() {\n    this.submit('nodeSubmitButton');\n  }\n\n  /**\n   * Get a copy of the table data\n   * @param tableData the table data to copy\n   * @return a copy of the table data\n   */\n  getCopyOfTableData(tableData) {\n    var tableDataCopy = null;\n\n    if (tableData != null) {\n      // create a JSON string from the table data\n      var tableDataJSONString = JSON.stringify(tableData);\n\n      // create a JSON object from the table data string\n      var tableDataJSON = JSON.parse(tableDataJSONString);\n\n      tableDataCopy = tableDataJSON;\n    }\n\n    return tableDataCopy;\n  };\n\n  /**\n   * Setup the table\n   */\n  setupTable() {\n\n    if (this.tableData == null) {\n      /*\n       * the student does not have any table data so we will use\n       * the table data from the component content\n       */\n      this.tableData = this.getCopyOfTableData(this.componentContent.tableData);\n    }\n  };\n\n  /**\n   * Reset the table data to its initial state from the component content\n   */\n  resetTable() {\n    if (this.UtilService.hasConnectedComponent(this.componentContent)) {\n      // this component imports work so we will import the work again\n      this.handleConnectedComponents();\n    } else {\n      // get the original table from the step content\n      this.tableData = this.getCopyOfTableData(this.componentContent.tableData);\n      this.studentDataChanged();\n    }\n  };\n\n  /**\n   * Get the rows of the table data\n   */\n  getTableDataRows() {\n    return this.tableData;\n  };\n\n  /**\n   * Populate the student work into the component\n   * @param componentState the component state to populate into the component\n   */\n  setStudentWork(componentState) {\n\n    if (componentState != null) {\n\n      // get the student data from the component state\n      var studentData = componentState.studentData;\n\n      if (studentData != null) {\n        // set the table into the controller\n        this.tableData = studentData.tableData;\n\n        var submitCounter = studentData.submitCounter;\n\n        if (submitCounter != null) {\n          // populate the submit counter\n          this.submitCounter = submitCounter;\n        }\n\n        this.processLatestStudentWork();\n      }\n    }\n  }\n\n  /**\n   * Create a new component state populated with the student data\n   * @param action the action that is triggering creating of this component state\n   * e.g. 'submit', 'save', 'change'\n   * @return a promise that will return a component state\n   */\n  createComponentState(action) {\n\n    var deferred = this.$q.defer();\n\n    // create a new component state\n    var componentState = this.NodeService.createNewComponentState();\n\n    var studentData = {};\n\n    // insert the table data\n    studentData.tableData = this.getCopyOfTableData(this.tableData);\n\n    // set the submit counter\n    studentData.submitCounter = this.submitCounter;\n\n    // set the flag for whether the student submitted this work\n    componentState.isSubmit = this.isSubmit;\n\n    // set the student data into the component state\n    componentState.studentData = studentData;\n\n    // set the component type\n    componentState.componentType = 'Table';\n\n    // set the node id\n    componentState.nodeId = this.nodeId;\n\n    // set the component id\n    componentState.componentId = this.componentId;\n\n    /*\n     * reset the isSubmit value so that the next component state\n     * doesn't maintain the same value\n     */\n    this.isSubmit = false;\n\n    /*\n     * perform any additional processing that is required before returning\n     * the component state\n     */\n    this.createComponentStateAdditionalProcessing(deferred, componentState, action);\n\n    return deferred.promise;\n  };\n\n  /**\n   * Create a new component state with no student data\n   * @return a component state with no student data\n   */\n  createBlankComponentState() {\n\n    // create a new component state\n    var componentState = this.NodeService.createNewComponentState();\n\n    if (componentState != null) {\n      var studentData = {};\n\n      // set the student data into the component state\n      componentState.studentData = studentData;\n    }\n\n    return componentState;\n  };\n\n  /**\n   * Check whether we need to show the reset table button\n   * @return whether to show the reset table button\n   */\n  showResetTableButton() {\n    return this.isResetTableButtonVisible;\n  };\n\n  /**\n   * Set the graph data into the table data\n   * @param componentState the component state to get the graph data from\n   * @param params (optional) the params to specify what columns\n   * and rows to overwrite in the table data\n   */\n  setGraphDataIntoTableData(componentState, params) {\n\n    var trialIndex = 0;\n    var seriesIndex = 0;\n\n    if (params != null) {\n\n      if (params.trialIndex != null) {\n        // get the trial index\n        trialIndex = params.trialIndex;\n      }\n\n      if (params.seriesIndex != null) {\n        // get the series index\n        seriesIndex = params.seriesIndex;\n      }\n\n      if (params.showDataAtMouseX) {\n        this.showDataAtMouseX(componentState, params);\n        return;\n      }\n    }\n\n    if (componentState != null && componentState.studentData != null) {\n\n      // get the student data\n      var studentData = componentState.studentData;\n\n      // get the student data version\n      var studentDataVersion = studentData.version;\n\n      if (studentDataVersion == null || studentDataVersion == 1) {\n        // this is the old student data format that can't contain trials\n\n        // get the series\n        var series = studentData.series;\n\n        if (series != null && series.length > 0) {\n\n          // get the series that we will get data from\n          var tempSeries = series[seriesIndex];\n\n          // set the series data into the table\n          this.setSeriesIntoTable(tempSeries);\n        }\n      } else {\n        // this is the new student data format that can contain trials\n\n        // get all the trials\n        var trials = studentData.trials;\n\n        if (trials != null) {\n\n          // get the specific trial we want\n          var trial = trials[trialIndex];\n\n          if (trial != null) {\n\n            // get the series in the trial\n            var multipleSeries = trial.series;\n\n            if (multipleSeries != null) {\n\n              // get the specific series we want\n              var series = multipleSeries[seriesIndex];\n\n              // set the series data into the table\n              this.setSeriesIntoTable(series);\n            }\n          }\n        }\n      }\n    }\n  };\n\n  /**\n   * Show the data at x for all the series.\n   * @param componentState The Graph component state.\n   * @param params The connected component params.\n   */\n  showDataAtMouseX(componentState, params) {\n    let studentData = componentState.studentData;\n    let mouseOverPoints = studentData.mouseOverPoints;\n    let x = null;\n\n    // get the x value from the latest mouse over point\n    if (mouseOverPoints != null && mouseOverPoints.length > 0) {\n      let latestMouseOverPoint = mouseOverPoints[mouseOverPoints.length - 1];\n      x = Math.round(latestMouseOverPoint[0]);\n    }\n    let xUnits = studentData.xAxis.units;\n    let yUnits = studentData.yAxis.units;\n    let xAxisTitle = studentData.xAxis.title.text;\n    let yAxisTitle = studentData.yAxis.title.text;\n    this.removeAllCellsFromTableData();\n    this.addTableDataRow(this.createTableRow(['Series Name', xAxisTitle, yAxisTitle]));\n    for (let trial of studentData.trials) {\n      if (trial.show) {\n        let multipleSeries = trial.series;\n        for (let singleSeries of multipleSeries) {\n          if (singleSeries.show !== false) {\n            let closestDataPoint = this.getClosestDataPoint(singleSeries.data, x);\n            if (closestDataPoint != null) {\n              this.addTableDataRow(this.createTableRow([singleSeries.name,\n                  Math.round(this.getXFromDataPoint(closestDataPoint)) + ' ' + xUnits,\n                  Math.round(this.getYFromDataPoint(closestDataPoint)) + ' ' + yUnits]));\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Remove all the rows and cells from the table data.\n   */\n  removeAllCellsFromTableData() {\n    this.tableData = [];\n  }\n\n  /**\n   * Append a row to the table data.\n   * @param row An array of objects. Each object represents a cell in the table.\n   */\n  addTableDataRow(row) {\n    this.tableData.push(row);\n  }\n\n  /**\n   * Create a cell object.\n   * @param text The text to show in the cell.\n   * @param editable Whether the student is allowed to edit the contents in the\n   * cell.\n   * @param size The with of the cell.\n   * @return An object.\n   */\n  createTableCell(text = '', editable = false, size = null) {\n    return { text: text, editable: editable, size: size };\n  }\n\n  /**\n   * Create a row.\n   * @param columns An array of strings or objects.\n   * @return An array of objects.\n   */\n  createTableRow(columns) {\n    let row = [];\n    for (let column of columns) {\n      if (column.constructor.name == 'String') {\n        row.push(this.createTableCell(column));\n      } else if (column.constructor.name == 'Object') {\n        row.push(this.createTableCell(column.text, column.editable, column.size));\n      }\n    }\n    return row;\n  }\n\n  /**\n   * Get the data point that has the closest x value to the given argument x.\n   * @param dataPoints An array of data points. Each data point can be an object\n   * or an array.\n   * @param x The argument x.\n   * @return A data point which can be an object or array.\n   */\n  getClosestDataPoint(dataPoints, x) {\n    let closestDataPoint = null;\n    let minNumericalXDifference = Infinity;\n    for (let dataPoint of dataPoints) {\n      let dataPointX = this.getXFromDataPoint(dataPoint);\n      let numericalDifference = this.getNumericalAbsoluteDifference(x, dataPointX);\n      if (numericalDifference < minNumericalXDifference) {\n        // we have found a new data point that is closer to x\n        closestDataPoint = dataPoint;\n        minNumericalXDifference = numericalDifference;\n      }\n    }\n    return closestDataPoint;\n  }\n\n  /**\n   * Get the absolute value of the difference between the two numbers.\n   * @param x1 A number.\n   * @param x2 A number.\n   * @return The absolute value of the difference between the two numbers.\n   */\n  getNumericalAbsoluteDifference(x1, x2) {\n    return Math.abs(x1 - x2);\n  }\n\n  /**\n   * Get the x value from the data point.\n   * @param dataPoint An object or array.\n   * @return The x value of the data point.\n   */\n  getXFromDataPoint(dataPoint) {\n    if (dataPoint.constructor.name == 'Object') {\n      return dataPoint.x;\n    } else if (dataPoint.constructor.name == 'Array') {\n      return dataPoint[0];\n    }\n  }\n\n  /**\n   * Get the y value from the data point.\n   * @param dataPoint An object or array.\n   * @return The y value of the data point.\n   */\n  getYFromDataPoint(dataPoint) {\n    if (dataPoint.constructor.name == 'Object') {\n      return dataPoint.y;\n    } else if (dataPoint.constructor.name == 'Array') {\n      return dataPoint[1];\n    }\n  }\n\n  /**\n   * Set the series data into the table\n   * @param series an object that contains the data for a single series\n   * @param params the parameters for where to place the points in the table\n   */\n  setSeriesIntoTable(series, params) {\n\n    /*\n     * the default is set to not skip the first row and for the\n     * x column to be the first column and the y column to be the\n     * second column\n     */\n    var skipFirstRow = true;\n    var xColumn = 0;\n    var yColumn = 1;\n\n    if (params != null) {\n\n      if (params.skipFirstRow != null) {\n        // determine whether to skip the first row\n        skipFirstRow = params.skipFirstRow;\n      }\n\n      if (params.xColumn != null) {\n        // get the x column\n        xColumn = params.xColumn;\n      }\n\n      if (params.yColumn != null) {\n        // get the y column\n        yColumn = params.yColumn;\n      }\n    }\n\n    if (series != null) {\n\n      // get the table data rows\n      var tableDataRows = this.getTableDataRows();\n\n      // get the data from the series\n      var data = series.data;\n\n      if (data != null) {\n\n        // our counter for traversing the data rows\n        var dataRowCounter = 0;\n\n        // loop through all the table data rows\n        for (var r = 0; r < tableDataRows.length; r++) {\n\n          if (skipFirstRow && r === 0) {\n            // skip the first table data row\n            continue;\n          }\n\n          var x = '';\n          var y = '';\n\n          // get the data row\n          var dataRow = data[dataRowCounter];\n\n          if (dataRow != null) {\n            // get the x and y values from the data row\n            x = dataRow[0];\n            y = dataRow[1];\n          }\n\n          // set the x and y values into the table data\n          this.setTableDataCellValue(xColumn, r, null, x);\n          this.setTableDataCellValue(yColumn, r, null, y);\n\n          // increment the data row counter\n          dataRowCounter++;\n        }\n      }\n    }\n  }\n\n  /**\n   * Set the table data cell value\n   * @param x the x index (0 indexed)\n   * @param y the y index (0 indexed)\n   * @param value the value to set in the cell\n   */\n  setTableDataCellValue(x, y, table, value) {\n\n    var tableDataRows = table;\n\n    if (table == null) {\n      // get the table data rows\n      tableDataRows = this.getTableDataRows();\n    }\n\n    if (tableDataRows != null) {\n\n      // get the row we want\n      var row = tableDataRows[y];\n\n      if (row != null) {\n\n        // get the cell we want\n        var cell = row[x];\n\n        if (cell != null) {\n\n          // set the value into the cell\n          cell.text = value;\n        }\n      }\n    }\n  };\n\n  /**\n   * Get the value of a cell in the table\n   * @param x the x coordinate\n   * @param y the y coordinate\n   * @param table (optional) table data to get the value from. this is used\n   * when we want to look up the value in the default authored table\n   * @returns the cell value (text or a number)\n   */\n  getTableDataCellValue(x, y, table) {\n\n    var cellValue = null;\n\n    if (table == null) {\n      // get the table data rows\n      table = this.getTableDataRows();\n    }\n\n    if (table != null) {\n\n      // get the row we want\n      var row = table[y];\n\n      if (row != null) {\n\n        // get the cell we want\n        var cell = row[x];\n\n        if (cell != null) {\n\n          // set the value into the cell\n          cellValue = cell.text;\n        }\n      }\n    }\n\n    return cellValue;\n  }\n\n  /**\n   * Get the number of rows in the table\n   * @returns the number of rows in the table\n   */\n  getNumRows() {\n    return this.componentContent.numRows;\n  }\n\n  /**\n   * Get the number of columns in the table\n   * @returns the number of columns in the table\n   */\n  getNumColumns() {\n    return this.componentContent.numColumns;\n  }\n\n  /**\n   * Check if the table is empty. The table is empty if all the\n   * cells are empty string.\n   * @returns whether the table is empty\n   */\n  isTableEmpty() {\n    var result = true;\n\n    var numRows = this.getNumRows();\n    var numColumns = this.getNumColumns();\n\n    // loop through all the rows\n    for (var r = 0; r < numRows; r++) {\n\n      // loop through all the cells in the row\n      for (var c = 0; c < numColumns; c++) {\n\n        // get a cell value\n        var cellValue = this.getTableDataCellValue(c, r);\n\n        if (cellValue != null && cellValue != '') {\n          // the cell is not empty so the table is not empty\n          result = false;\n          break;\n        }\n      }\n\n      if (result == false) {\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Check if the table is set to the default values. The table\n   * is set to the default values if all the cells match the\n   * values in the default authored table.\n   * @returns whether the table is set to the default values\n   */\n  isTableReset() {\n    var result = true;\n\n    var numRows = this.getNumRows();\n    var numColumns = this.getNumColumns();\n\n    // get the default table\n    var defaultTable = this.componentContent.tableData;\n\n    // loop through all the rows\n    for (var r = 0; r < numRows; r++) {\n\n      // loop through all the cells in the row\n      for (var c = 0; c < numColumns; c++) {\n\n        // get the cell value from the student table\n        var cellValue = this.getTableDataCellValue(c, r);\n\n        // get the cell value from the default table\n        var defaultCellValue = this.getTableDataCellValue(c, r, defaultTable);\n\n        if (cellValue != defaultCellValue) {\n          // the cell values do not match so the table is not set to the default values\n          result = false;\n          break;\n        }\n      }\n\n      if (result == false) {\n        break;\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Snip the table by converting it to an image\n   * @param $event the click event\n   */\n  snipTable($event) {\n    // get the table element. this will obtain an array.\n    var tableElement = angular.element('#table_' + this.nodeId + '_' + this.componentId);\n\n    if (tableElement != null && tableElement.length > 0) {\n      // get the table element\n      tableElement = tableElement[0];\n\n      // convert the table element to a canvas element\n      html2canvas(tableElement).then((canvas) => {\n        // get the canvas as a base64 string\n        var img_b64 = canvas.toDataURL('image/png');\n\n        // get the image object\n        var imageObject = this.UtilService.getImageObjectFromBase64String(img_b64);\n\n        // create a notebook item with the image populated into it\n        this.NotebookService.addNote($event, imageObject);\n      });\n    }\n  }\n\n  /**\n   * Copy the table data cell text from one component state to another\n   * @param fromComponentState get the cell text values from this component state\n   * @param toComponentState set the cell text values in this component state\n   */\n  copyTableDataCellText(fromComponentState, toComponentState) {\n\n    if (fromComponentState != null && toComponentState != null) {\n      var fromStudentData = fromComponentState.studentData;\n      var toStudentData = toComponentState.studentData;\n\n      if (fromStudentData != null && toStudentData != null) {\n        var fromTableData = fromStudentData.tableData;\n        var toTableData = toStudentData.tableData;\n\n        if (fromTableData != null & toTableData != null) {\n\n          // loop through all the rows\n          for (var y = 0; y < this.getNumRows(); y++) {\n\n            // loop through all the columns\n            for (var x = 0; x < this.getNumColumns(); x++) {\n\n              // get the cell value\n              var cellValue = this.getTableDataCellValue(x, y, fromTableData);\n\n              if (cellValue != null) {\n                // set the cell value\n                this.setTableDataCellValue(x, y, toTableData, cellValue);\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return toComponentState;\n  }\n\n  /**\n   * Only merges the first component state\n   * TODO: implement merging all component states\n   * @param {array} componentStates\n   * @return {object} merged component state\n   */\n  createMergedComponentState(componentStates) {\n    const defaultComponentState = this.createBlankComponentState();\n    defaultComponentState.studentData.tableData = this.getCopyOfTableData(this.componentContent.tableData);\n    return this.copyTableDataCellText(componentStates[0], defaultComponentState);\n  }\n}\n\nTableController.$inject = [\n  '$anchorScroll',\n  '$filter',\n  '$location',\n  '$mdDialog',\n  '$q',\n  '$rootScope',\n  '$scope',\n  'AnnotationService',\n  'ConfigService',\n  'NodeService',\n  'NotebookService',\n  'ProjectService',\n  'StudentAssetService',\n  'StudentDataService',\n  'TableService',\n  'UtilService'\n];\n\nexport default TableController;\n"]}